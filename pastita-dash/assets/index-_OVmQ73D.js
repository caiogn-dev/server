import{j as e}from"./vendor-charts-o9Lo7m6Z.js";import{e as se,l as ue,r as i,R as pe}from"./vendor-react-C2HNIXra.js";import{d as ae,t as F,X as g,a5 as te,ac as K,bd as J,x as re,q as be,aj as I,af as le,a4 as h,ba as ne,ak as je,h as fe,E as ye,l as q,R as u,a as O,a6 as Q,ag as Ne,aL as ve,aa as X,z as W,p as Z,aO as we,ah as ke}from"./feature-automation-CLWK1V5x.js";import"./index-DQDVHdIA.js";import{m as L}from"./marketingService-D9ImcE5m.js";import{g as G}from"./vendor-utils-DaXQUBrP.js";import"./vendor-ui-B9rDAafI.js";import"./vendor-mui-DKuE-Kg_.js";const v=[{id:"template",label:"Template",icon:re},{id:"content",label:"ConteÃºdo",icon:F},{id:"audience",label:"AudiÃªncia",icon:be},{id:"review",label:"Enviar",icon:I}],Se=[{type:"all",title:"Todos os Contatos",description:"Enviar para todos os subscribers ativos",icon:J},{type:"segment",title:"Segmento",description:"Filtrar por tags, compras, etc",icon:je},{type:"custom",title:"Lista Personalizada",description:"Selecionar contatos especÃ­ficos",icon:fe}],Ae=()=>{const k=se(),[w]=ue(),{storeId:b,storeName:N}=ae(),[d,S]=i.useState("template"),[M,_]=i.useState(!0),[j,E]=i.useState(!1),[H,T]=i.useState([]),[f,$]=i.useState(null),[p,C]=i.useState([]),[y,V]=i.useState(""),[R,B]=i.useState([]),[U,P]=i.useState(!1),[r,a]=i.useState({name:"",subject:"",from_name:N||"Pastita",html_content:"",audienceType:"all",segmentFilters:{tags:[],minOrders:null,minSpent:null,hasOrdered:null},selectedSubscribers:[],variables:{}});i.useEffect(()=>{(async()=>{if(b){_(!0);try{const[t,l]=await Promise.all([L.emailTemplates.list(b),L.subscribers.list(b,{status:"active"})]);T(t),C(l);const m=new Set;l.forEach(c=>c.tags?.forEach(z=>m.add(z))),B(Array.from(m));const x=w.get("template");if(x){const c=t.find(z=>z.slug===x);c&&Y(c)}}catch(t){q.error("Failed to load data",t),u.error("Erro ao carregar dados")}finally{_(!1)}}})()},[b,w]);const n=i.useMemo(()=>{let s=p;if(r.audienceType==="segment"){const{tags:t,minOrders:l,minSpent:m,hasOrdered:x}=r.segmentFilters;t.length>0&&(s=s.filter(c=>t.some(z=>c.tags?.includes(z)))),l!==null&&(s=s.filter(c=>c.total_orders>=l)),m!==null&&(s=s.filter(c=>c.total_spent>=m)),x===!0?s=s.filter(c=>c.total_orders>0):x===!1&&(s=s.filter(c=>c.total_orders===0))}if(y){const t=y.toLowerCase();s=s.filter(l=>l.email.toLowerCase().includes(t)||l.name.toLowerCase().includes(t))}return s},[p,r.audienceType,r.segmentFilters,y]),o=i.useMemo(()=>{switch(r.audienceType){case"all":return p.length;case"segment":return n.length;case"custom":return r.selectedSubscribers.length;default:return 0}},[r.audienceType,p.length,n.length,r.selectedSubscribers.length]),Y=s=>{$(s),a(t=>({...t,name:`Campanha - ${s.name}`,subject:s.subject,html_content:s.html_content,variables:s.variables?.reduce((l,m)=>({...l,[m]:""}),{})||{}})),S("content")},ie=(s,t)=>{a(l=>({...l,variables:{...l.variables,[s]:t}}))},ce=s=>{a(t=>({...t,selectedSubscribers:t.selectedSubscribers.includes(s)?t.selectedSubscribers.filter(l=>l!==s):[...t.selectedSubscribers,s]}))},de=()=>{a(s=>({...s,selectedSubscribers:n.map(t=>t.id)}))},oe=()=>{a(s=>({...s,selectedSubscribers:[]}))},A=i.useCallback(()=>{let s=r.html_content;return Object.entries(r.variables).forEach(([t,l])=>{s=s.replace(new RegExp(`\\{\\{${t}\\}\\}`,"g"),l||`{{${t}}}`)}),s=s.replace(/\{\{store_name\}\}/g,N||"Loja"),s=s.replace(/\{\{year\}\}/g,new Date().getFullYear().toString()),s},[r.html_content,r.variables,N]),me=async()=>{if(!b){u.error("Selecione uma loja");return}if(o===0){u.error("Selecione pelo menos um destinatÃ¡rio");return}E(!0);try{const s=A(),t={store:b,name:r.name,subject:r.subject,html_content:s,from_name:r.from_name||N||"Pastita",audience_type:r.audienceType};let l={};r.audienceType==="segment"?l={audience_filters:{tags:r.segmentFilters.tags,min_orders:r.segmentFilters.minOrders,min_spent:r.segmentFilters.minSpent}}:r.audienceType==="custom"&&(l={recipient_list:p.filter(D=>r.selectedSubscribers.includes(D.id)).map(D=>({email:D.email,name:D.name}))});const m={...t,...l};q.info("Creating campaign",{payload:m});const x=await L.emailCampaigns.create(m),c=await L.emailCampaigns.send(x.id);c.success?(u.success(`ðŸŽ‰ Campanha enviada para ${o} contatos!`),k("/marketing")):u.error(c.error||"Erro ao enviar campanha")}catch(s){const t=s;q.error("Failed to send campaign",s),u.error(t.response?.data?.error?.message||"Erro ao enviar campanha")}finally{E(!1)}},xe=()=>{switch(d){case"template":return!!f;case"content":return!!r.subject&&!!r.name;case"audience":return o>0;case"review":return!0;default:return!1}},he=()=>{const s=v.findIndex(t=>t.id===d);s<v.length-1&&S(v[s+1].id)},ge=()=>{const s=v.findIndex(t=>t.id===d);s>0&&S(v[s-1].id)};return b?M?e.jsx(te,{}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-black",children:[e.jsx("div",{className:"bg-white dark:bg-zinc-900 border-b sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>k("/marketing"),className:"p-2 hover:bg-gray-100 dark:hover:bg-zinc-700 dark:bg-gray-700 rounded-lg transition-colors",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Nova Campanha"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:N})]})]}),d!=="template"&&e.jsxs("div",{className:"flex items-center gap-2 bg-primary-50 text-primary-700 px-3 py-1.5 rounded-full",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:[o," destinatÃ¡rios"]})]})]}),e.jsx("div",{className:"flex items-center gap-2 mt-4 overflow-x-auto pb-2",children:v.map((s,t)=>{const l=s.icon,m=s.id===d,x=v.findIndex(c=>c.id===d)>t;return e.jsxs(pe.Fragment,{children:[e.jsxs("button",{onClick:()=>x&&S(s.id),disabled:!x&&!m,className:`flex items-center gap-2 px-4 py-2 rounded-lg whitespace-nowrap transition-colors ${m?"bg-primary-100 text-primary-700":x?"bg-green-100 text-green-700 cursor-pointer hover:bg-green-200":"bg-gray-100 text-gray-400"}`,children:[x?e.jsx(le,{className:"w-5 h-5"}):e.jsx(l,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:s.label})]}),t<v.length-1&&e.jsx("div",{className:`w-8 h-0.5 ${x?"bg-green-300":"bg-gray-200"}`})]},s.id)})})]})}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[d==="template"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Escolha um Template"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:"Selecione um template para comeÃ§ar sua campanha."})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:H.map(s=>e.jsxs("button",{onClick:()=>Y(s),className:`bg-white rounded-xl border text-left cursor-pointer transition-all hover:shadow-lg ${f?.id===s.id?"ring-2 ring-primary-500 border-primary-500":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"h-32 bg-gradient-to-br from-primary-50 to-primary-100 relative overflow-hidden rounded-t-xl flex items-center justify-center",children:e.jsx(F,{className:"w-12 h-12 text-primary-300"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 line-clamp-1",children:s.subject})]})]},s.id))})]}),d==="content"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"InformaÃ§Ãµes da Campanha"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Nome da Campanha"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>a(t=>({...t,name:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Ex: PromoÃ§Ã£o de Natal"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Assunto do Email"}),e.jsx("input",{type:"text",value:r.subject,onChange:s=>a(t=>({...t,subject:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Ex: ðŸŽ Presente especial para vocÃª!"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Nome do Remetente"}),e.jsx("input",{type:"text",value:r.from_name,onChange:s=>a(t=>({...t,from_name:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Ex: Pastita"})]})]})]}),e.jsx(h,{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(re,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"PersonalizaÃ§Ã£o AutomÃ¡tica"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"As variÃ¡veis do template serÃ£o preenchidas automaticamente com os dados de cada cliente:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:["{{customer_name}}"," â†’ Nome do cliente"]}),e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:["{{first_name}}"," â†’ Primeiro nome"]}),e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:["{{email}}"," â†’ Email"]}),e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:["{{store_name}}"," â†’ Nome da loja"]})]})]})]})}),f&&f.variables&&f.variables.filter(s=>!["customer_name","first_name","name","email","phone","store_name","store_url","year"].includes(s)).length>0&&e.jsxs(h,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Valores Personalizados"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 mb-4",children:"Preencha os valores especÃ­ficos desta campanha:"}),e.jsx("div",{className:"space-y-4",children:f.variables.filter(s=>!["customer_name","first_name","name","email","phone","store_name","store_url","year"].includes(s)).map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:s.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}),e.jsx("input",{type:"text",value:r.variables[s]||"",onChange:t=>ie(s,t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:`Ex: ${s==="coupon_code"?"DESCONTO10":s==="discount_value"?"10%":s==="expiry_date"?"31/12/2026":""}`})]},s))})]})]}),e.jsx("div",{children:e.jsxs(h,{className:"p-4 sticky top-32",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Preview"}),e.jsxs(g,{variant:"secondary",size:"sm",onClick:()=>P(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),"Expandir"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",style:{height:"400px"},children:e.jsx("iframe",{srcDoc:A(),className:"w-full h-full",title:"Preview"})})]})})]}),d==="audience"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Selecione a AudiÃªncia"}),e.jsxs("p",{className:"text-gray-500 dark:text-zinc-400",children:["VocÃª tem ",e.jsx("strong",{children:p.length})," contatos ativos."]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Se.map(s=>{const t=s.icon,l=r.audienceType===s.type;return e.jsxs("button",{onClick:()=>a(m=>({...m,audienceType:s.type,selectedSubscribers:s.type==="all"?[]:m.selectedSubscribers})),className:`p-4 rounded-xl border-2 text-left transition-all ${l?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsx(t,{className:`w-8 h-8 mb-2 ${l?"text-primary-600":"text-gray-400"}`}),e.jsx("h3",{className:`font-semibold ${l?"text-primary-900":"text-gray-900"}`,children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:s.description})]},s.type)})}),r.audienceType==="segment"&&e.jsxs(h,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Filtros do Segmento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[R.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(s=>e.jsx("button",{onClick:()=>{a(t=>({...t,segmentFilters:{...t.segmentFilters,tags:t.segmentFilters.tags.includes(s)?t.segmentFilters.tags.filter(l=>l!==s):[...t.segmentFilters.tags,s]}}))},className:`px-3 py-1 rounded-full text-sm transition-colors ${r.segmentFilters.tags.includes(s)?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-2",children:"MÃ­nimo de Pedidos"}),e.jsx("input",{type:"number",min:"0",value:r.segmentFilters.minOrders??"",onChange:s=>a(t=>({...t,segmentFilters:{...t.segmentFilters,minOrders:s.target.value?parseInt(s.target.value):null}})),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Ex: 1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-2",children:"HistÃ³rico de Compras"}),e.jsxs("select",{value:r.segmentFilters.hasOrdered===null?"":String(r.segmentFilters.hasOrdered),onChange:s=>a(t=>({...t,segmentFilters:{...t.segmentFilters,hasOrdered:s.target.value===""?null:s.target.value==="true"}})),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"true",children:"JÃ¡ compraram"}),e.jsx("option",{value:"false",children:"Nunca compraram"})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-black rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-zinc-400",children:[e.jsx("strong",{children:n.length})," contatos correspondem aos filtros"]})})]}),r.audienceType==="custom"&&e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Selecionar Contatos"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"secondary",size:"sm",onClick:de,children:"Selecionar Todos"}),e.jsx(g,{variant:"secondary",size:"sm",onClick:oe,children:"Limpar"})]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(ye,{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:y,onChange:s=>V(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Buscar por email ou nome..."})]}),e.jsx("div",{className:"border rounded-lg divide-y max-h-80 overflow-y-auto",children:n.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-zinc-400",children:"Nenhum contato encontrado"}):n.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 dark:hover:bg-zinc-700 dark:bg-black cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.selectedSubscribers.includes(s.id),onChange:()=>ce(s.id),className:"w-4 h-4 text-primary-600 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:s.email}),s.name&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 truncate",children:s.name})]}),s.total_orders>0&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full",children:[s.total_orders," pedidos"]})]},s.id))}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-zinc-400 mt-4",children:[r.selectedSubscribers.length," de ",n.length," selecionados"]})]}),e.jsx(h,{className:"p-4 bg-primary-50 border-primary-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"w-8 h-8 text-primary-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-primary-900",children:[o," ",o===1?"destinatÃ¡rio":"destinatÃ¡rios"]}),e.jsxs("p",{className:"text-sm text-primary-700",children:[r.audienceType==="all"&&"Todos os contatos ativos",r.audienceType==="segment"&&"Contatos que correspondem aos filtros",r.audienceType==="custom"&&"Contatos selecionados manualmente"]})]})]})})]}),d==="review"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Resumo da Campanha"}),e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("dt",{className:"text-gray-500 dark:text-zinc-400",children:"Nome"}),e.jsx("dd",{className:"font-medium text-gray-900 dark:text-white",children:r.name})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("dt",{className:"text-gray-500 dark:text-zinc-400",children:"Assunto"}),e.jsx("dd",{className:"font-medium text-gray-900 dark:text-white",children:r.subject})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("dt",{className:"text-gray-500 dark:text-zinc-400",children:"Remetente"}),e.jsx("dd",{className:"font-medium text-gray-900 dark:text-white",children:r.from_name})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("dt",{className:"text-gray-500 dark:text-zinc-400",children:"Template"}),e.jsx("dd",{className:"font-medium text-gray-900 dark:text-white",children:f?.name})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("dt",{className:"text-gray-500 dark:text-zinc-400",children:"DestinatÃ¡rios"}),e.jsxs("dd",{className:"font-medium text-primary-600",children:[o," contatos"]})]})]})]}),e.jsxs(h,{className:"p-6 bg-amber-50 border-amber-200",children:[e.jsxs("h3",{className:"font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"Pronto para enviar?"]}),e.jsxs("p",{className:"text-amber-700 text-sm",children:['Ao clicar em "Enviar Campanha", os emails serÃ£o disparados imediatamente para ',o," ",o===1?"contato":"contatos","."]})]})]}),e.jsx("div",{children:e.jsxs(h,{className:"p-4 sticky top-32",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Preview Final"}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",style:{height:"400px"},children:e.jsx("iframe",{srcDoc:A(),className:"w-full h-full",title:"Preview"})})]})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t",children:[e.jsxs(g,{variant:"secondary",onClick:ge,disabled:d==="template",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"Voltar"]}),d==="review"?e.jsx(g,{onClick:me,disabled:j||o===0,className:"bg-green-600 hover:bg-green-700 text-white",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-5 h-5 mr-2"}),"Enviar para ",o," contatos"]})}):e.jsx(g,{onClick:he,disabled:!xe(),children:"PrÃ³ximo"})]})]}),U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"font-semibold",children:"Preview do Email"}),e.jsx("button",{onClick:()=>P(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-zinc-700 dark:bg-gray-700 rounded-lg",children:"âœ•"})]}),e.jsx("div",{className:"p-4",style:{height:"calc(90vh - 80px)"},children:e.jsx("iframe",{srcDoc:A(),className:"w-full h-full border rounded-lg",title:"Preview"})})]})})]}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(F,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Nenhuma loja selecionada"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400 mb-4",children:"Selecione uma loja para criar campanhas."}),e.jsx(g,{onClick:()=>k("/stores"),children:"Ver Lojas"})]})},ee={draft:{label:"Rascunho",color:"bg-gray-100 text-gray-700",icon:W},scheduled:{label:"Agendada",color:"bg-blue-100 text-blue-700",icon:W},sending:{label:"Enviando",color:"bg-yellow-100 text-yellow-700",icon:X},sent:{label:"Enviada",color:"bg-green-100 text-green-700",icon:le},paused:{label:"Pausada",color:"bg-orange-100 text-orange-700",icon:ve},cancelled:{label:"Cancelada",color:"bg-red-100 text-red-700",icon:Ne}},Ce={all:"Todos",customers:"Clientes",subscribers:"Inscritos",segment:"Segmento",custom:"Personalizado"},De=()=>{const k=se(),{storeId:w}=ae(),[b,N]=i.useState(!0),[d,S]=i.useState([]),[M,_]=i.useState(null),[j,E]=i.useState([]),[H,T]=i.useState(!1),[f,$]=i.useState(!1),[p,C]=i.useState(null),y=i.useCallback(async()=>{try{N(!0),console.log("Loading campaigns, storeId:",w);const a={};w&&(a.store=w);const n=await O.get("/marketing/campaigns/",{params:a});console.log("Campaigns response:",n.data);const o=n.data.results||n.data||[];S(Array.isArray(o)?o:[])}catch(a){console.error("Error loading campaigns:",a),u.error("Erro ao carregar campanhas")}finally{N(!1)}},[w]);i.useEffect(()=>{y()},[y]);const V=async a=>{try{T(!0);const n=await O.get(`/marketing/campaigns/${a}/recipients/`);E(n.data.results||n.data||[])}catch(n){console.error("Error loading recipients:",n),u.error("Erro ao carregar destinatÃ¡rios")}finally{T(!1)}},R=async a=>{_(a),$(!0),await V(a.id)},B=async a=>{if(confirm(`Enviar campanha "${a.name}" agora?`))try{C(a.id);const n=await O.post(`/marketing/campaigns/${a.id}/send/`);u.success(`Campanha enviada! ${n.data.sent} emails enviados.`),y()}catch(n){u.error(n.response?.data?.error||"Erro ao enviar campanha")}finally{C(null)}},U=async a=>{if(confirm(`Excluir campanha "${a.name}"?`))try{C(a.id),await O.delete(`/marketing/campaigns/${a.id}/`),u.success("Campanha excluÃ­da"),y()}catch{u.error("Erro ao excluir campanha")}finally{C(null)}},P=a=>!a.emails_delivered||a.emails_delivered===0?0:(a.emails_opened/a.emails_delivered*100).toFixed(1),r=a=>!a.emails_opened||a.emails_opened===0?0:(a.emails_clicked/a.emails_opened*100).toFixed(1);return b?e.jsx(te,{}):e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Campanhas de Email"}),e.jsxs("p",{className:"text-gray-500 dark:text-zinc-400",children:[d.length," campanha(s)"]})]}),e.jsxs(g,{onClick:()=>k("/marketing/email/new"),children:[e.jsx(Q,{className:"w-5 h-5 mr-2"}),"Nova Campanha"]})]}),d.length===0?e.jsxs(h,{className:"p-12 text-center",children:[e.jsx(F,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Nenhuma campanha criada"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400 mb-6",children:"Crie sua primeira campanha de email marketing"}),e.jsxs(g,{onClick:()=>k("/marketing/email/new"),children:[e.jsx(Q,{className:"w-5 h-5 mr-2"}),"Criar Campanha"]})]}):e.jsx("div",{className:"space-y-4",children:d.map(a=>{const n=ee[a.status]||ee.draft,o=n.icon;return e.jsx(h,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:a.name}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium ${n.color}`,children:[e.jsx(o,{className:"w-3 h-3"}),n.label]})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 truncate mb-2",children:a.subject}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs text-gray-400",children:[e.jsxs("span",{children:["AudiÃªncia: ",Ce[a.audience_type]||a.audience_type]}),e.jsxs("span",{children:["Criada: ",G(new Date(a.created_at),"dd/MM/yyyy 'Ã s' HH:mm",{locale:Z})]}),a.completed_at&&e.jsxs("span",{children:["Enviada: ",G(new Date(a.completed_at),"dd/MM/yyyy 'Ã s' HH:mm",{locale:Z})]})]})]}),a.status==="sent"&&e.jsxs("div",{className:"flex items-center gap-6 px-4 py-2 bg-gray-50 dark:bg-black rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:a.emails_sent}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400",children:"Enviados"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:[P(a),"%"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400",children:"Abertura"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[r(a),"%"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400",children:"Cliques"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.status==="draft"&&e.jsx(g,{size:"sm",onClick:()=>B(a),disabled:p===a.id,children:p===a.id?e.jsx(X,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Enviar"]})}),e.jsxs(g,{variant:"secondary",size:"sm",onClick:()=>R(a),children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),"Detalhes"]}),a.status==="draft"&&e.jsx(g,{variant:"danger",size:"sm",onClick:()=>U(a),disabled:p===a.id,children:e.jsx(we,{className:"w-4 h-4"})})]})]})},a.id)})}),e.jsx(ke,{isOpen:f,onClose:()=>{$(!1),_(null),E([])},title:`DestinatÃ¡rios - ${M?.name||""}`,size:"xl",children:H?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(X,{className:"w-8 h-8 text-gray-400 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:"Carregando destinatÃ¡rios..."})]}):j.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(F,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:"Nenhum destinatÃ¡rio encontrado"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4 bg-gray-50 dark:bg-black rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:j.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:j.filter(a=>a.status==="sent"||a.status==="delivered"||a.status==="opened"||a.status==="clicked").length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400",children:"Enviados"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:j.filter(a=>a.status==="opened"||a.status==="clicked").length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400",children:"Abertos"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:j.filter(a=>a.status==="failed"||a.status==="bounced").length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400",children:"Falhas"})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-black sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-zinc-400 px-4 py-2",children:"Email"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-zinc-400 px-4 py-2",children:"Nome"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-zinc-400 px-4 py-2",children:"Status"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-zinc-400 px-4 py-2",children:"Enviado em"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-zinc-400 px-4 py-2",children:"Erro"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:j.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-zinc-700 dark:bg-black",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:a.email}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 dark:text-zinc-400",children:a.name||"-"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${a.status==="sent"||a.status==="delivered"?"bg-green-100 text-green-700":a.status==="opened"||a.status==="clicked"?"bg-blue-100 text-blue-700":a.status==="failed"||a.status==="bounced"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:a.status})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 dark:text-zinc-400",children:a.sent_at?G(new Date(a.sent_at),"dd/MM HH:mm"):"-"}),e.jsx("td",{className:"px-4 py-2 text-sm text-red-500 max-w-xs truncate",title:a.error_message||"",children:a.error_message||"-"})]},a.id))})]})})]})})]})};export{De as CampaignsListPage,Ae as NewCampaignPage};
