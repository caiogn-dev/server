import{j as e,R as ze,A as De,C as Le,X as Oe,Y as Be,T as We,a as Fe}from"./vendor-charts-o9Lo7m6Z.js";import{c as Ae,r as u}from"./vendor-react-C2HNIXra.js";import{u as Ee,i as x,a as ue,B as o,T as a,F as Ve,I as He,S as Ue,M as I,b as T,c as Ge,A as se,d as Ke,e as C,G as l,C as $,f as w,g as Ne,h as xe,j as v,k as q,L as F,l as ae,m as oe,n as ne,o as z,q as i,r as ie,D as Ye}from"./vendor-mui-DKuE-Kg_.js";import{a as b,g as Xe,l as _,p as le}from"./feature-automation-CLWK1V5x.js";import{g as A,p as de}from"./vendor-utils-DaXQUBrP.js";var V={},E={};const Qe=Ae(Ee);var ce;function h(){return ce||(ce=1,function(s){"use client";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=Qe}(E)),E}var Je=x;Object.defineProperty(V,"__esModule",{value:!0});var he=V.default=void 0,Ze=Je(h()),et=e;he=V.default=(0,Ze.default)((0,et.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");var H={},tt=x;Object.defineProperty(H,"__esModule",{value:!0});var je=H.default=void 0,rt=tt(h()),st=e;je=H.default=(0,rt.default)((0,st.jsx)("path",{d:"m16 18 2.29-2.29-4.88-4.88-4 4L2 7.41 3.41 6l6 6 4-4 6.3 6.29L22 12v6z"}),"TrendingDown");var U={},at=x;Object.defineProperty(U,"__esModule",{value:!0});var ve=U.default=void 0,ot=at(h()),nt=e;ve=U.default=(0,ot.default)((0,nt.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download");var G={},it=x;Object.defineProperty(G,"__esModule",{value:!0});var pe=G.default=void 0,lt=it(h()),dt=e;pe=G.default=(0,lt.default)((0,dt.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");var K={},ct=x;Object.defineProperty(K,"__esModule",{value:!0});var me=K.default=void 0,ut=ct(h()),xt=e;me=K.default=(0,ut.default)((0,xt.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart");var N={},ht=x;Object.defineProperty(N,"__esModule",{value:!0});var fe=N.default=void 0,jt=ht(h()),vt=e;fe=N.default=(0,jt.default)((0,vt.jsx)("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"}),"Inventory");var Y={},pt=x;Object.defineProperty(Y,"__esModule",{value:!0});var ye=Y.default=void 0,mt=pt(h()),ft=e;ye=Y.default=(0,mt.default)((0,ft.jsx)("path",{d:"M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4"}),"AttachMoney");var X={},yt=x;Object.defineProperty(X,"__esModule",{value:!0});var L=X.default=void 0,gt=yt(h()),bt=e;L=X.default=(0,gt.default)((0,bt.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");var Q={},_t=x;Object.defineProperty(Q,"__esModule",{value:!0});var ge=Q.default=void 0,Rt=_t(h()),St=e;ge=Q.default=(0,Rt.default)((0,St.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle");var J={},Ct=x;Object.defineProperty(J,"__esModule",{value:!0});var be=J.default=void 0,$t=Ct(h()),wt=e;be=J.default=(0,$t.default)((0,wt.jsx)("path",{d:"M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m13.5-9 1.96 2.5H17V9.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"LocalShipping");var Z={},kt=x;Object.defineProperty(Z,"__esModule",{value:!0});var _e=Z.default=void 0,Mt=kt(h()),Pt=e;_e=Z.default=(0,Mt.default)((0,Pt.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star");const It="pastita",k="/stores/reports",R=()=>Xe()||It,Tt=async(s={})=>{try{return(await b.get(`${k}/revenue/`,{params:{store:R(),...s}})).data}catch(r){throw _.error("Failed to fetch revenue report",r),r}},qt=async(s={})=>{try{return(await b.get(`${k}/products/`,{params:{store:R(),...s}})).data}catch(r){throw _.error("Failed to fetch products report",r),r}},zt=async s=>{try{return(await b.get(`${k}/stock/`,{params:{store:R(),low_stock:s}})).data}catch(r){throw _.error("Failed to fetch stock report",r),r}},Dt=async(s={})=>{try{return(await b.get(`${k}/customers/`,{params:{store:R(),...s}})).data}catch(r){throw _.error("Failed to fetch customers report",r),r}},Lt=async()=>{try{return(await b.get("/dashboard-stats/",{params:{store:R()}})).data}catch(s){throw _.error("Failed to fetch dashboard stats",s),s}},Ot=async(s={})=>{try{return(await b.get(`${k}/orders/export/`,{params:{store:R(),...s},responseType:"blob"})).data}catch(r){throw _.error("Failed to export orders",r),r}},Bt=(s,r)=>{const p=window.URL.createObjectURL(s),n=document.createElement("a");n.href=p,n.download=r,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(p)},m={getRevenueReport:Tt,getProductsReport:qt,getStockReport:zt,getCustomersReport:Dt,getDashboardStats:Lt,exportOrdersCSV:Ot,downloadBlob:Bt},f=({title:s,value:r,subtitle:p,change:n,icon:O,color:d="#6366f1",loading:S})=>(ue(),e.jsx($,{sx:{height:"100%",background:`linear-gradient(135deg, ${v(d,.1)} 0%, ${v(d,.05)} 100%)`,border:`1px solid ${v(d,.2)}`,transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:`0 8px 24px ${v(d,.2)}`}},children:e.jsx(w,{children:e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(o,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:s}),S?e.jsx(xe,{size:24}):e.jsx(a,{variant:"h4",fontWeight:"bold",color:d,children:r}),p&&e.jsx(a,{variant:"body2",color:"text.secondary",mt:.5,children:p}),n!==void 0&&e.jsxs(o,{display:"flex",alignItems:"center",mt:1,children:[n>=0?e.jsx(he,{sx:{color:"success.main",fontSize:18,mr:.5}}):e.jsx(je,{sx:{color:"error.main",fontSize:18,mr:.5}}),e.jsxs(a,{variant:"body2",color:n>=0?"success.main":"error.main",fontWeight:"medium",children:[n>=0?"+":"",n.toFixed(1),"%"]}),e.jsx(a,{variant:"body2",color:"text.secondary",ml:.5,children:"vs ontem"})]})]}),e.jsx(o,{sx:{p:1.5,borderRadius:2,bgcolor:v(d,.15),color:d},children:O})]})})})),D=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),Wt=()=>{const s=ue(),[r,p]=u.useState("overview"),[n,O]=u.useState("30d"),[d,S]=u.useState("day"),[c,ee]=u.useState(!0),[te,B]=u.useState(null),[y,Re]=u.useState(null),[Se,Ce]=u.useState(null),[re,$e]=u.useState(null),[g,we]=u.useState(null),[M,ke]=u.useState(null),W=u.useCallback(async()=>{ee(!0),B(null);try{const[t,j,Ie,Te,qe]=await Promise.all([m.getDashboardStats(),m.getRevenueReport({period:n,group_by:d}),m.getProductsReport({period:n}),m.getStockReport(),m.getCustomersReport({period:n})]);Re(t),Ce(j),$e(Ie),we(Te),ke(qe)}catch(t){console.error("Failed to load reports:",t),B("Erro ao carregar relatórios. Tente novamente.")}finally{ee(!1)}},[n,d]);u.useEffect(()=>{W()},[W]);const Me=async()=>{try{const t=await m.exportOrdersCSV({period:n}),j=`pedidos_${A(new Date,"yyyy-MM-dd")}.csv`;m.downloadBlob(t,j)}catch(t){console.error("Export failed:",t)}},P=()=>e.jsxs(o,{children:[e.jsxs(l,{container:!0,spacing:3,mb:4,children:[e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(f,{title:"Faturamento Hoje",value:D(y?.today.revenue||0),change:y?.today.revenue_change_percent,icon:e.jsx(ye,{}),color:"#22c55e",loading:c})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(f,{title:"Pedidos Hoje",value:y?.today.orders||0,subtitle:`${y?.week.orders||0} esta semana`,icon:e.jsx(me,{}),color:"#6366f1",loading:c})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(f,{title:"Pedidos Pendentes",value:y?.alerts.pending_orders||0,subtitle:"Aguardando ação",icon:e.jsx(be,{}),color:"#f59e0b",loading:c})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(f,{title:"Estoque Baixo",value:y?.alerts.low_stock_products||0,subtitle:"Produtos para repor",icon:e.jsx(L,{}),color:"#ef4444",loading:c})})]}),e.jsx($,{sx:{mb:4},children:e.jsxs(w,{children:[e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(a,{variant:"h6",fontWeight:"bold",children:"Faturamento"}),e.jsxs(Ne,{size:"small",children:[e.jsx(T,{variant:d==="day"?"contained":"outlined",onClick:()=>S("day"),children:"Dia"}),e.jsx(T,{variant:d==="week"?"contained":"outlined",onClick:()=>S("week"),children:"Semana"}),e.jsx(T,{variant:d==="month"?"contained":"outlined",onClick:()=>S("month"),children:"Mês"})]})]}),c?e.jsx(o,{display:"flex",justifyContent:"center",py:8,children:e.jsx(xe,{})}):e.jsx(ze,{width:"100%",height:350,children:e.jsxs(De,{data:Se?.data||[],children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#6366f1",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#6366f1",stopOpacity:0})]})}),e.jsx(Le,{strokeDasharray:"3 3",stroke:v(s.palette.divider,.5)}),e.jsx(Oe,{dataKey:"period",tickFormatter:t=>{try{return A(de(t),"dd/MM",{locale:le})}catch{return t}},stroke:s.palette.text.secondary}),e.jsx(Be,{tickFormatter:t=>`R$ ${(t/1e3).toFixed(0)}k`,stroke:s.palette.text.secondary}),e.jsx(We,{formatter:t=>[D(t??0),"Faturamento"],labelFormatter:t=>{try{return A(de(t),"dd 'de' MMMM",{locale:le})}catch{return t}},contentStyle:{backgroundColor:s.palette.background.paper,border:`1px solid ${s.palette.divider}`,borderRadius:8}}),e.jsx(Fe,{type:"monotone",dataKey:"total_revenue",stroke:"#6366f1",strokeWidth:2,fill:"url(#colorRevenue)"})]})})]})}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx($,{sx:{height:"100%"},children:e.jsxs(w,{children:[e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(a,{variant:"h6",fontWeight:"bold",children:"Produtos Mais Vendidos"}),e.jsx(q,{label:`Top ${re?.top_products.length||0}`,size:"small"})]}),c?e.jsx(F,{}):e.jsx(ae,{children:e.jsxs(oe,{size:"small",children:[e.jsx(ne,{children:e.jsxs(z,{children:[e.jsx(i,{children:"Produto"}),e.jsx(i,{align:"right",children:"Qtd"}),e.jsx(i,{align:"right",children:"Receita"})]})}),e.jsx(ie,{children:re?.top_products.slice(0,5).map((t,j)=>e.jsxs(z,{children:[e.jsx(i,{children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[j<3&&e.jsx(_e,{sx:{color:j===0?"#fbbf24":j===1?"#9ca3af":"#cd7f32",fontSize:16}}),e.jsx(a,{variant:"body2",noWrap:!0,sx:{maxWidth:150},children:t.product_name})]})}),e.jsx(i,{align:"right",children:e.jsx(a,{variant:"body2",fontWeight:"medium",children:t.total_quantity})}),e.jsx(i,{align:"right",children:e.jsx(a,{variant:"body2",color:"success.main",fontWeight:"medium",children:D(t.total_revenue)})})]},t.product_id||j))})]})})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx($,{sx:{height:"100%"},children:e.jsxs(w,{children:[e.jsx(a,{variant:"h6",fontWeight:"bold",mb:2,children:"Clientes"}),c?e.jsx(F,{}):e.jsxs(o,{children:[e.jsxs(l,{container:!0,spacing:2,mb:3,children:[e.jsx(l,{item:!0,xs:6,children:e.jsxs(o,{textAlign:"center",p:2,bgcolor:v("#6366f1",.1),borderRadius:2,children:[e.jsx(a,{variant:"h4",fontWeight:"bold",color:"primary",children:M?.summary.total_customers||0}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total de Clientes"})]})}),e.jsx(l,{item:!0,xs:6,children:e.jsxs(o,{textAlign:"center",p:2,bgcolor:v("#22c55e",.1),borderRadius:2,children:[e.jsxs(a,{variant:"h4",fontWeight:"bold",color:"success.main",children:[M?.summary.retention_rate||0,"%"]}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Taxa de Retenção"})]})})]}),e.jsx(Ye,{sx:{my:2}}),e.jsxs(o,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Novos Clientes"}),e.jsx(a,{variant:"body2",fontWeight:"medium",children:M?.summary.new_customers||0})]}),e.jsxs(o,{display:"flex",justifyContent:"space-between",children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Clientes Recorrentes"}),e.jsx(a,{variant:"body2",fontWeight:"medium",children:M?.summary.returning_customers||0})]})]})]})})})]})]}),Pe=()=>e.jsxs(o,{children:[e.jsxs(l,{container:!0,spacing:3,mb:4,children:[e.jsx(l,{item:!0,xs:12,sm:4,children:e.jsx(f,{title:"Total de Produtos",value:g?.summary.total_products||0,icon:e.jsx(fe,{}),color:"#6366f1",loading:c})}),e.jsx(l,{item:!0,xs:12,sm:4,children:e.jsx(f,{title:"Estoque Baixo",value:g?.summary.low_stock_count||0,subtitle:`Limite: ${g?.summary.low_stock_threshold||10} unidades`,icon:e.jsx(L,{}),color:"#f59e0b",loading:c})}),e.jsx(l,{item:!0,xs:12,sm:4,children:e.jsx(f,{title:"Sem Estoque",value:g?.summary.out_of_stock_count||0,subtitle:"Reposição urgente",icon:e.jsx(L,{}),color:"#ef4444",loading:c})})]}),e.jsx($,{children:e.jsxs(w,{children:[e.jsx(a,{variant:"h6",fontWeight:"bold",mb:3,children:"Produtos com Estoque Baixo"}),c?e.jsx(F,{}):g?.low_stock_products.length===0?e.jsx(se,{severity:"success",icon:e.jsx(ge,{}),children:"Todos os produtos estão com estoque adequado!"}):e.jsx(ae,{children:e.jsxs(oe,{children:[e.jsx(ne,{children:e.jsxs(z,{children:[e.jsx(i,{children:"Produto"}),e.jsx(i,{children:"SKU"}),e.jsx(i,{children:"Categoria"}),e.jsx(i,{align:"right",children:"Estoque"}),e.jsx(i,{align:"right",children:"Preço"}),e.jsx(i,{children:"Status"})]})}),e.jsx(ie,{children:g?.low_stock_products.map(t=>e.jsxs(z,{children:[e.jsx(i,{children:e.jsx(a,{variant:"body2",fontWeight:"medium",children:t.name})}),e.jsx(i,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:t.sku||"-"})}),e.jsx(i,{children:e.jsx(q,{label:t.category||"Sem categoria",size:"small",variant:"outlined"})}),e.jsx(i,{align:"right",children:e.jsx(q,{label:t.stock_quantity||0,size:"small",color:t.stock_quantity===0?"error":"warning"})}),e.jsx(i,{align:"right",children:e.jsx(a,{variant:"body2",children:D(t.price)})}),e.jsx(i,{children:e.jsx(q,{label:t.status==="active"?"Ativo":"Inativo",size:"small",color:t.status==="active"?"success":"default"})})]},t.id))})]})})]})})]});return e.jsxs(o,{p:3,children:[e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,children:[e.jsxs(o,{children:[e.jsx(a,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Relatórios"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Análise completa do seu negócio"})]}),e.jsxs(o,{display:"flex",gap:2,children:[e.jsxs(Ve,{size:"small",sx:{minWidth:120},children:[e.jsx(He,{children:"Período"}),e.jsxs(Ue,{value:n,label:"Período",onChange:t=>O(t.target.value),children:[e.jsx(I,{value:"7d",children:"7 dias"}),e.jsx(I,{value:"30d",children:"30 dias"}),e.jsx(I,{value:"90d",children:"90 dias"}),e.jsx(I,{value:"1y",children:"1 ano"})]})]}),e.jsx(T,{variant:"outlined",startIcon:e.jsx(ve,{}),onClick:Me,children:"Exportar"}),e.jsx(Ge,{onClick:W,disabled:c,children:e.jsx(pe,{})})]})]}),te&&e.jsx(se,{severity:"error",sx:{mb:3},onClose:()=>B(null),children:te}),e.jsxs(Ke,{value:r,onChange:(t,j)=>p(j),sx:{mb:3,borderBottom:1,borderColor:"divider"},children:[e.jsx(C,{label:"Visão Geral",value:"overview"}),e.jsx(C,{label:"Faturamento",value:"revenue"}),e.jsx(C,{label:"Produtos",value:"products"}),e.jsx(C,{label:"Estoque",value:"stock"}),e.jsx(C,{label:"Clientes",value:"customers"})]}),r==="overview"&&P(),r==="stock"&&Pe(),r==="revenue"&&P(),r==="products"&&P(),r==="customers"&&P()]})},Ut=Object.freeze(Object.defineProperty({__proto__:null,AnalyticsPage:Wt},Symbol.toStringTag,{value:"Module"}));export{pe as d,Ut as i,h as r};
