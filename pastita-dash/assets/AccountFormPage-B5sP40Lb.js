import{j as e}from"./vendor-charts-o9Lo7m6Z.js";import{e as A,u as C,r as l,L as S}from"./vendor-react-C2HNIXra.js";import{ab as I,l as E,U as p,R as d,Z as b,$ as z,a0 as P,X as m,ac as T,a4 as u,W as o,a3 as D}from"./feature-automation-CLWK1V5x.js";import{u as q}from"./index-DQDVHdIA.js";import"./vendor-utils-DaXQUBrP.js";import"./vendor-ui-B9rDAafI.js";import"./vendor-mui-DKuE-Kg_.js";const U=()=>{const c=A(),{id:i}=C(),{updateAccount:g}=q(),n=!!i,[x,f]=l.useState(!1),[v,_]=l.useState(!1),[k,y]=l.useState([]),[t,s]=l.useState({name:"",phone_number_id:"",waba_id:"",phone_number:"",display_phone_number:"",access_token:"",webhook_verify_token:"",auto_response_enabled:!0,human_handoff_enabled:!0,default_agent:""});l.useEffect(()=>{j(),n&&w()},[i]);const j=async()=>{try{const a=await I.getAgents();y(a.filter(r=>r.status==="active"))}catch(a){E.error("Error loading agents:",a)}},w=async()=>{f(!0);try{const a=await p.getAccount(i);s({name:a.name,phone_number_id:a.phone_number_id,waba_id:a.waba_id,phone_number:a.phone_number,display_phone_number:a.display_phone_number,access_token:"",webhook_verify_token:"",auto_response_enabled:a.auto_response_enabled,human_handoff_enabled:a.human_handoff_enabled,default_agent:a.default_agent||""})}catch(a){d.error(b(a)),c("/accounts")}finally{f(!1)}},N=async a=>{a.preventDefault(),_(!0);try{const r={name:t.name,display_phone_number:t.display_phone_number,auto_response_enabled:t.auto_response_enabled,human_handoff_enabled:t.human_handoff_enabled,default_agent:t.default_agent||null};n?t.access_token&&(r.access_token=t.access_token):(r.phone_number_id=t.phone_number_id,r.waba_id=t.waba_id,r.phone_number=t.phone_number,r.access_token=t.access_token,r.webhook_verify_token=t.webhook_verify_token);let h;n?(h=await p.updateAccount(i,r),g(h),d.success("Conta atualizada com sucesso!")):(h=await p.createAccount(r),d.success("Conta criada com sucesso!")),c("/accounts")}catch(r){d.error(b(r))}finally{_(!1)}};return x?e.jsx(z,{}):e.jsxs("div",{className:"p-6",children:[e.jsx(P,{title:n?"Editar Conta":"Nova Conta",subtitle:n?t.name:"Cadastre uma nova conta WhatsApp Business",actions:e.jsx(m,{variant:"ghost",onClick:()=>c("/accounts"),leftIcon:e.jsx(T,{className:"w-5 h-5"}),children:"Voltar"})}),e.jsx("form",{onSubmit:N,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(u,{title:"Informações Básicas",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{label:"Nome da Conta",required:!0,value:t.name,onChange:a=>s({...t,name:a.target.value}),placeholder:"Ex: Minha Empresa"}),e.jsx(o,{label:"Phone Number ID",required:!0,disabled:n,value:t.phone_number_id,onChange:a=>s({...t,phone_number_id:a.target.value}),placeholder:"ID do número no Meta",helperText:"Encontre no Meta Developer Portal"}),e.jsx(o,{label:"WABA ID",required:!0,disabled:n,value:t.waba_id,onChange:a=>s({...t,waba_id:a.target.value}),placeholder:"WhatsApp Business Account ID"}),e.jsx(o,{label:"Número de Telefone",required:!0,disabled:n,value:t.phone_number,onChange:a=>s({...t,phone_number:a.target.value}),placeholder:"5511999999999"}),e.jsx(o,{label:"Número para Exibição",value:t.display_phone_number,onChange:a=>s({...t,display_phone_number:a.target.value}),placeholder:"+55 11 99999-9999"})]})}),e.jsx(u,{title:"Autenticação",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{label:"Access Token",type:"password",required:!n,value:t.access_token,onChange:a=>s({...t,access_token:a.target.value}),placeholder:n?"Deixe em branco para manter o atual":"Token de acesso do Meta",helperText:n?"Preencha apenas se quiser atualizar o token":"Token permanente ou de longa duração"}),e.jsx(o,{label:"Webhook Verify Token",value:t.webhook_verify_token,onChange:a=>s({...t,webhook_verify_token:a.target.value}),placeholder:"Token de verificação do webhook",helperText:"Usado para verificar webhooks do Meta"})]})}),e.jsx(u,{title:"Automação",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(D,{label:"Agente IA Padrão",value:t.default_agent,onChange:a=>s({...t,default_agent:a.target.value}),options:[{value:"",label:"Nenhum"},...k.map(a=>({value:a.id,label:a.name}))]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400",children:e.jsx(S,{to:"/agents",className:"text-green-600 hover:text-green-700",children:"Gerenciar Agentes IA →"})}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:"Resposta Automática"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Processar mensagens com Agente IA automaticamente"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.auto_response_enabled,onChange:a=>s({...t,auto_response_enabled:a.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white dark:bg-zinc-900 after:border-gray-300 dark:border-zinc-700 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-500"})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:"Handoff para Humano"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Permitir transferência para atendente humano"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.human_handoff_enabled,onChange:a=>s({...t,human_handoff_enabled:a.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white dark:bg-zinc-900 after:border-gray-300 dark:border-zinc-700 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-500"})]})]})]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(m,{variant:"secondary",onClick:()=>c("/accounts"),children:"Cancelar"}),e.jsx(m,{type:"submit",isLoading:v,children:n?"Salvar Alterações":"Criar Conta"})]})})]})})]})};export{U as AccountFormPage};
