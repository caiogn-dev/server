const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/feature-automation-CLWK1V5x.js","assets/vendor-react-C2HNIXra.js","assets/vendor-charts-o9Lo7m6Z.js","assets/vendor-utils-DaXQUBrP.js","assets/vendor-ui-B9rDAafI.js","assets/vendor-mui-DKuE-Kg_.js","assets/feature-automation-Bw916Bj0.css"])))=>i.map(i=>d[i]);
import{_ as Fe}from"./index-DQDVHdIA.js";import{j as e}from"./vendor-charts-o9Lo7m6Z.js";import{e as me,r as m,R as Ae}from"./vendor-react-C2HNIXra.js";import{a as x,a5 as xe,j as U,X as d,ac as ce,bd as Re,i as pe,q as O,aj as he,af as ge,a4 as v,W as X,k as le,U as B,R as o,a6 as Y,bb as Te,aO as Ie,z as Z,ah as K,l as b,aM as Q,be as ie,aa as oe,aL as de,ae as Le,ag as Ee}from"./feature-automation-CLWK1V5x.js";import"./vendor-utils-DaXQUBrP.js";import"./vendor-ui-B9rDAafI.js";import"./vendor-mui-DKuE-Kg_.js";const N={getCampaigns:async r=>(await x.get("/campaigns/campaigns/",{params:r})).data,getCampaign:async r=>(await x.get(`/campaigns/campaigns/${r}/`)).data,createCampaign:async r=>(await x.post("/campaigns/campaigns/",r)).data,updateCampaign:async(r,c)=>(await x.patch(`/campaigns/campaigns/${r}/`,c)).data,deleteCampaign:async r=>{await x.delete(`/campaigns/campaigns/${r}/`)},scheduleCampaign:async(r,c)=>(await x.post(`/campaigns/campaigns/${r}/schedule/`,{scheduled_at:c})).data,startCampaign:async r=>(await x.post(`/campaigns/campaigns/${r}/start/`)).data,pauseCampaign:async r=>(await x.post(`/campaigns/campaigns/${r}/pause/`)).data,resumeCampaign:async r=>(await x.post(`/campaigns/campaigns/${r}/resume/`)).data,cancelCampaign:async r=>(await x.post(`/campaigns/campaigns/${r}/cancel/`)).data,getCampaignStats:async r=>(await x.get(`/campaigns/campaigns/${r}/stats/`)).data,getCampaignRecipients:async(r,c)=>{const u={};return c&&(u.status=c),(await x.get(`/campaigns/campaigns/${r}/recipients/`,{params:u})).data},addRecipients:async(r,c)=>(await x.post(`/campaigns/campaigns/${r}/add_recipients/`,{contacts:c})).data,getScheduledMessages:async r=>(await x.get("/campaigns/scheduled/",{params:r})).data,getScheduledMessage:async r=>(await x.get(`/campaigns/scheduled/${r}/`)).data,createScheduledMessage:async r=>(await x.post("/campaigns/scheduled/",r)).data,updateScheduledMessage:async(r,c)=>(await x.patch(`/campaigns/scheduled/${r}/`,c)).data,cancelScheduledMessage:async r=>(await x.post(`/campaigns/scheduled/${r}/cancel/`)).data,getScheduledMessagesStats:async r=>{const c={};return r&&(c.account_id=r),(await x.get("/campaigns/scheduled/stats/",{params:c})).data},getContactLists:async r=>(await x.get("/campaigns/contacts/",{params:r})).data,getContactList:async r=>(await x.get(`/campaigns/contacts/${r}/`)).data,createContactList:async r=>(await x.post("/campaigns/contacts/",r)).data,updateContactList:async(r,c)=>(await x.patch(`/campaigns/contacts/${r}/`,c)).data,deleteContactList:async r=>{await x.delete(`/campaigns/contacts/${r}/`)},importContactsFromCSV:async r=>(await x.post("/campaigns/contacts/import_csv/",r)).data},z=[{id:"account",label:"Conta",icon:U},{id:"message",label:"Mensagem",icon:pe},{id:"recipients",label:"Destinat√°rios",icon:O},{id:"review",label:"Enviar",icon:he}],Oe=()=>{const r=me(),[c,u]=m.useState("account"),[E,M]=m.useState(!0),[C,A]=m.useState(!1),[p,R]=m.useState([]),[f,y]=m.useState([]),[w,P]=m.useState([]),[q,T]=m.useState(!1),[J,_]=m.useState(!1),[G,I]=m.useState(!1),[L,s]=m.useState(""),[h,$]=m.useState({phone:"",name:""}),[F,ee]=m.useState([]),[ue,ae]=m.useState(!1),[k,D]=m.useState(new Set),[n,j]=m.useState({name:"",description:"",accountId:"",messageType:"template",templateId:"",templateName:"",templateLanguage:"pt_BR",textContent:"",contacts:[],scheduledAt:"",messagesPerMinute:60});m.useEffect(()=>{(async()=>{M(!0);try{const l=(await B.getAccounts()).results||[];R(l),l.length===1&&j(g=>({...g,accountId:l[0].id}));try{const g=await N.getContactLists();P(g.results||[])}catch{P([])}}catch(t){b.error("Failed to load accounts",t),R([])}finally{M(!1)}})()},[]),m.useEffect(()=>{(async()=>{if(n.accountId)try{const l=(await B.getTemplates(n.accountId)).results||[];y(l.filter(g=>g.status==="approved"))}catch(t){b.error("Failed to load templates",t),y([])}})()},[n.accountId]);const W=m.useMemo(()=>p.find(a=>a.id===n.accountId),[p,n.accountId]),se=m.useMemo(()=>f.find(a=>a.id===n.templateId),[f,n.templateId]),V=n.contacts.length,je=a=>{j(t=>({...t,accountId:a,templateId:"",templateName:""})),u("message")},ye=a=>{j(t=>({...t,templateId:a.id,templateName:a.name,templateLanguage:a.language,name:t.name||`Campanha - ${a.name}`}))},be=async()=>{ae(!0),I(!0);try{const{conversationsService:a}=await Fe(async()=>{const{conversationsService:i}=await import("./feature-automation-CLWK1V5x.js").then(S=>S.bw);return{conversationsService:i}},__vite__mapDeps([0,1,2,3,4,5,6])),t={limit:"500"};n.accountId&&(t.account=n.accountId);const g=(await a.getConversations(t)).results.map(i=>({phone:i.phone_number,name:i.contact_name||i.phone_number,last_message_at:i.last_message_at||void 0,source:"conversation"}));ee(g),D(new Set)}catch(a){b.error("Failed to load system contacts",a),o.error("Erro ao carregar contatos"),ee([])}finally{ae(!1)}},fe=a=>{D(t=>{const l=new Set(t);return l.has(a)?l.delete(a):l.add(a),l})},Ne=()=>{k.size===F.length?D(new Set):D(new Set(F.map(a=>a.phone)))},we=()=>{const a=new Set(n.contacts.map(l=>l.phone)),t=[];if(F.forEach(l=>{k.has(l.phone)&&!a.has(l.phone)&&t.push({phone:l.phone,name:l.name})}),t.length===0){o.error("Nenhum contato novo selecionado");return}j(l=>({...l,contacts:[...l.contacts,...t]})),o.success(`${t.length} contatos adicionados`),I(!1),D(new Set)},ve=()=>{if(!h.phone){o.error("Informe o n√∫mero de telefone");return}const a=h.phone.replace(/\D/g,"");if(n.contacts.some(t=>t.phone.replace(/\D/g,"")===a)){o.error("Este n√∫mero j√° foi adicionado");return}j(t=>({...t,contacts:[...t.contacts,{phone:a,name:h.name}]})),$({phone:"",name:""})},Ce=a=>{j(t=>({...t,contacts:t.contacts.filter((l,g)=>g!==a)}))},ke=()=>{if(!L.trim()){o.error("Cole o conte√∫do do CSV");return}try{const a=L.trim().split(`
`),t=[];for(let i=0;i<a.length;i++){const S=a[i].trim();if(!S||i===0&&(S.toLowerCase().includes("phone")||S.toLowerCase().includes("telefone")))continue;const re=S.split(/[,;\t]/),H=re[0]?.replace(/\D/g,""),$e=re[1]?.trim()||"";H&&H.length>=10&&t.push({phone:H,name:$e})}if(t.length===0){o.error("Nenhum contato v√°lido encontrado");return}const l=new Set(n.contacts.map(i=>i.phone)),g=t.filter(i=>!l.has(i.phone));j(i=>({...i,contacts:[...i.contacts,...g]})),o.success(`${g.length} contatos importados`),_(!1),s("")}catch(a){b.error("CSV import error",a),o.error("Erro ao processar CSV")}},Se=async a=>{try{const t=await N.getContactList(a),l=new Set(n.contacts.map(i=>i.phone)),g=t.contacts.filter(i=>!l.has(i.phone));j(i=>({...i,contacts:[...i.contacts,...g]})),o.success(`${g.length} contatos adicionados da lista "${t.name}"`)}catch(t){b.error("Failed to load contact list",t),o.error("Erro ao carregar lista de contatos")}},te=async(a=!1)=>{if(!n.accountId){o.error("Selecione uma conta WhatsApp");return}if(n.messageType==="template"&&!n.templateId){o.error("Selecione um template");return}if(n.messageType==="text"&&!n.textContent.trim()){o.error("Digite o conte√∫do da mensagem");return}if(n.contacts.length===0){o.error("Adicione pelo menos um destinat√°rio");return}if(a&&!n.scheduledAt){o.error("Selecione a data/hora do agendamento");return}A(!0);try{const t={account_id:n.accountId,name:n.name||`Campanha WhatsApp - ${new Date().toLocaleDateString("pt-BR")}`,description:n.description,campaign_type:"broadcast",template_id:n.messageType==="template"?n.templateId:void 0,message_content:n.messageType==="text"?{text:n.textContent}:{template_name:n.templateName,language:n.templateLanguage},contact_list:n.contacts,scheduled_at:a?n.scheduledAt:void 0,messages_per_minute:n.messagesPerMinute};b.info("Creating WhatsApp campaign",{payload:t});const l=await N.createCampaign(t);a?(await N.scheduleCampaign(l.id,n.scheduledAt),o.success(`üéâ Campanha agendada para ${new Date(n.scheduledAt).toLocaleString("pt-BR")}`)):(await N.startCampaign(l.id),o.success(`üéâ Campanha iniciada! Enviando para ${V} contatos...`)),r("/marketing/whatsapp")}catch(t){const l=t;b.error("Failed to create campaign",t),o.error(l.response?.data?.error||"Erro ao criar campanha")}finally{A(!1),T(!1)}},ne=()=>{switch(c){case"account":return!!n.accountId;case"message":return n.messageType==="template"?!!n.templateId:!!n.textContent.trim();case"recipients":return n.contacts.length>0;case"review":return!0;default:return!1}},ze=()=>{const a=z.findIndex(t=>t.id===c);a<z.length-1&&u(z[a+1].id)},_e=()=>{const a=z.findIndex(t=>t.id===c);a>0&&u(z[a-1].id)};return E?e.jsx(xe,{}):p.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(U,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Nenhuma conta WhatsApp"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400 mb-4",children:"Configure uma conta WhatsApp para criar campanhas."}),e.jsx(d,{onClick:()=>r("/accounts/new"),children:"Adicionar Conta"})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-black",children:[e.jsx("div",{className:"bg-white dark:bg-zinc-900 border-b sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>r("/marketing/whatsapp"),className:"p-2 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-lg transition-colors",children:e.jsx(ce,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Nova Campanha WhatsApp"}),W&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:[W.name," ‚Ä¢ ",W.display_phone_number||W.phone_number]})]})]}),c!=="account"&&V>0&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 text-green-700 px-3 py-1.5 rounded-full",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:[V," destinat√°rios"]})]})]}),e.jsx("div",{className:"flex items-center gap-2 mt-4 overflow-x-auto pb-2",children:z.map((a,t)=>{const l=a.icon,g=a.id===c,i=z.findIndex(S=>S.id===c)>t;return e.jsxs(Ae.Fragment,{children:[e.jsxs("button",{onClick:()=>i&&u(a.id),disabled:!i&&!g,className:`flex items-center gap-2 px-4 py-2 rounded-lg whitespace-nowrap transition-colors ${g?"bg-green-100 text-green-700":i?"bg-green-100 text-green-700 cursor-pointer hover:bg-green-200":"bg-gray-100 text-gray-400"}`,children:[i?e.jsx(ge,{className:"w-5 h-5"}):e.jsx(l,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:a.label})]}),t<z.length-1&&e.jsx("div",{className:`w-8 h-0.5 ${i?"bg-green-300":"bg-gray-200"}`})]},a.id)})})]})}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[c==="account"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Selecione a Conta WhatsApp"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:"Escolha a conta que ser√° usada para enviar as mensagens"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:p.map(a=>e.jsxs("button",{onClick:()=>je(a.id),className:`p-4 rounded-xl border-2 text-left transition-all ${n.accountId===a.id?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-zinc-800 hover:border-green-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${a.status==="active"?"bg-green-100":"bg-gray-100"}`,children:e.jsx(U,{className:`w-6 h-6 ${a.status==="active"?"text-green-600":"text-gray-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:a.display_phone_number||a.phone_number})]})]}),e.jsx("div",{className:"mt-3 flex items-center gap-2",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${a.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:a.status==="active"?"Ativa":a.status})})]},a.id))})]}),c==="message"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Configure a Mensagem"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:"Escolha o tipo de mensagem e configure o conte√∫do"})]}),e.jsxs(v,{className:"p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-2",children:"Nome da Campanha"}),e.jsx(X,{value:n.name,onChange:a=>j(t=>({...t,name:a.target.value})),placeholder:"Ex: Promo√ß√£o de Janeiro"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>j(a=>({...a,messageType:"template"})),className:`p-4 rounded-xl border-2 text-left transition-all ${n.messageType==="template"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-zinc-800 hover:border-green-300"}`,children:[e.jsx(le,{className:"w-8 h-8 text-green-600 mb-2"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Template"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Use um template aprovado pelo WhatsApp"})]}),e.jsxs("button",{onClick:()=>j(a=>({...a,messageType:"text"})),className:`p-4 rounded-xl border-2 text-left transition-all ${n.messageType==="text"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-zinc-800 hover:border-green-300"}`,children:[e.jsx(pe,{className:"w-8 h-8 text-blue-600 mb-2"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Texto Livre"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Envie uma mensagem de texto personalizada"})]})]}),n.messageType==="template"&&e.jsxs(v,{className:"p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-2",children:"Selecione o Template"}),f.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"Nenhum template aprovado encontrado"}),e.jsx(d,{variant:"secondary",size:"sm",className:"mt-2",onClick:()=>B.syncTemplates(n.accountId).then(()=>{o.success("Templates sincronizados"),B.getTemplates(n.accountId).then(a=>y(a.results.filter(t=>t.status==="approved")))}),children:"Sincronizar Templates"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:f.map(a=>e.jsxs("button",{onClick:()=>ye(a),className:`p-3 rounded-lg border text-left transition-all ${n.templateId===a.id?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-zinc-800 hover:border-green-300"}`,children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[a.category," ‚Ä¢ ",a.language]})]},a.id))})]}),n.messageType==="text"&&e.jsxs(v,{className:"p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-2",children:"Mensagem"}),e.jsx("textarea",{value:n.textContent,onChange:a=>j(t=>({...t,textContent:a.target.value})),placeholder:"Digite sua mensagem aqui...",rows:6,className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Use ","{{nome}}"," para personalizar com o nome do contato"]})]})]}),c==="recipients"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Adicione os Destinat√°rios"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:"Adicione os contatos que receber√£o a mensagem"})]}),e.jsxs(v,{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Adicionar Contato"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{value:h.phone,onChange:a=>$(t=>({...t,phone:a.target.value})),placeholder:"Telefone (ex: 5511999999999)",className:"flex-1"}),e.jsx(X,{value:h.name,onChange:a=>$(t=>({...t,name:a.target.value})),placeholder:"Nome (opcional)",className:"flex-1"}),e.jsx(d,{onClick:ve,children:e.jsx(Y,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(d,{variant:"secondary",onClick:be,children:[e.jsx(O,{className:"w-5 h-5 mr-2"}),"Carregar do Sistema"]}),e.jsxs(d,{variant:"secondary",onClick:()=>_(!0),children:[e.jsx(Te,{className:"w-5 h-5 mr-2"}),"Importar CSV"]}),w.length>0&&e.jsxs("select",{onChange:a=>a.target.value&&Se(a.target.value),className:"px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",defaultValue:"",children:[e.jsx("option",{value:"",children:"Carregar lista salva..."}),w.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.contact_count," contatos)"]},a.id))]})]}),e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white",children:["Contatos (",n.contacts.length,")"]}),n.contacts.length>0&&e.jsx(d,{variant:"secondary",size:"sm",onClick:()=>j(a=>({...a,contacts:[]})),children:"Limpar Todos"})]}),n.contacts.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(O,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"Nenhum contato adicionado"})]}):e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:n.contacts.map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:a.phone}),a.name&&e.jsxs("span",{className:"text-gray-500 dark:text-zinc-400 ml-2",children:["(",a.name,")"]})]}),e.jsx("button",{onClick:()=>Ce(t),className:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:e.jsx(Ie,{className:"w-4 h-4"})})]},t))})]})]}),c==="review"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Revise e Envie"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:"Confira os detalhes da campanha antes de enviar"})]}),e.jsxs(v,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Campanha"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:n.name||"Sem nome"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Conta"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:W?.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Tipo de Mensagem"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:n.messageType==="template"?"Template":"Texto Livre"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Destinat√°rios"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[V," contatos"]})]})]}),n.messageType==="template"&&se&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 mb-1",children:"Template"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:se.name})]}),n.messageType==="text"&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 mb-1",children:"Mensagem"}),e.jsx("p",{className:"text-gray-900 dark:text-white whitespace-pre-wrap bg-gray-50 dark:bg-gray-700 p-3 rounded-lg",children:n.textContent})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("label",{className:"block text-sm text-gray-500 dark:text-zinc-400 mb-2",children:"Velocidade de Envio"}),e.jsxs("select",{value:n.messagesPerMinute,onChange:a=>j(t=>({...t,messagesPerMinute:Number(a.target.value)})),className:"px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:30,children:"30 mensagens/minuto (Conservador)"}),e.jsx("option",{value:60,children:"60 mensagens/minuto (Recomendado)"}),e.jsx("option",{value:120,children:"120 mensagens/minuto (R√°pido)"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Tempo estimado: ~",Math.ceil(V/n.messagesPerMinute)," minutos"]})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Aten√ß√£o:"})," Certifique-se de que todos os contatos consentiram em receber mensagens. O envio de spam pode resultar em bloqueio da sua conta WhatsApp Business."]})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t",children:[e.jsxs(d,{variant:"secondary",onClick:_e,disabled:c==="account",children:[e.jsx(ce,{className:"w-5 h-5 mr-2"}),"Voltar"]}),e.jsx("div",{className:"flex gap-3",children:c==="review"?e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"secondary",onClick:()=>T(!0),disabled:C,children:[e.jsx(Z,{className:"w-5 h-5 mr-2"}),"Agendar"]}),e.jsx(d,{onClick:()=>te(!1),disabled:C||!ne(),children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-5 h-5 mr-2"}),"Enviar Agora"]})})]}):e.jsx(d,{onClick:ze,disabled:!ne(),children:"Continuar"})})]})]}),e.jsx(K,{isOpen:q,onClose:()=>T(!1),title:"Agendar Campanha",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-2",children:"Data e Hora"}),e.jsx("input",{type:"datetime-local",value:n.scheduledAt,onChange:a=>j(t=>({...t,scheduledAt:a.target.value})),min:new Date().toISOString().slice(0,16),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(d,{variant:"secondary",onClick:()=>T(!1),children:"Cancelar"}),e.jsx(d,{onClick:()=>te(!0),disabled:C||!n.scheduledAt,children:C?"Agendando...":"Confirmar Agendamento"})]})]})}),e.jsx(K,{isOpen:J,onClose:()=>_(!1),title:"Importar Contatos do CSV",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Cole o conte√∫do do CSV abaixo. Formato esperado: telefone,nome (uma linha por contato)"}),e.jsx("textarea",{value:L,onChange:a=>s(a.target.value),placeholder:`5511999999999,Jo√£o Silva
5511888888888,Maria Santos`,rows:8,className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:text-white font-mono text-sm"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(d,{variant:"secondary",onClick:()=>_(!1),children:"Cancelar"}),e.jsx(d,{onClick:ke,children:"Importar"})]})]})}),e.jsx(K,{isOpen:G,onClose:()=>I(!1),title:"Contatos do Sistema",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Selecione os contatos que deseja adicionar √† campanha"}),ue?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full animate-spin"})}):F.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(O,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"Nenhum contato encontrado no sistema"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k.size===F.length,onChange:Ne,className:"w-4 h-4 text-green-600 rounded focus:ring-green-500"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:["Selecionar todos (",F.length,")"]})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[k.size," selecionados"]})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border rounded-lg p-2",children:F.map(a=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 dark:hover:bg-zinc-700 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k.has(a.phone),onChange:()=>fe(a.phone),className:"w-4 h-4 text-green-600 rounded focus:ring-green-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:a.phone}),a.name&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 truncate",children:a.name})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${a.source==="conversation"?"bg-blue-100 text-blue-700":a.source==="order"?"bg-green-100 text-green-700":a.source==="subscriber"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:a.source==="conversation"?"Conversa":a.source==="order"?"Pedido":a.source==="subscriber"?"Inscrito":a.source==="session"?"Sess√£o":a.source})]},a.phone))})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(d,{variant:"secondary",onClick:()=>I(!1),children:"Cancelar"}),e.jsxs(d,{onClick:we,disabled:k.size===0,children:["Adicionar ",k.size>0?`(${k.size})`:""]})]})]})})]})},Ue=()=>{const r=me(),[c,u]=m.useState(!0),[E,M]=m.useState([]),[C,A]=m.useState(null),[p,R]=m.useState(null),[f,y]=m.useState(null),w=m.useCallback(async()=>{try{u(!0);const s=await N.getCampaigns();M(s.results||[])}catch(s){b.error("Failed to load campaigns",s),M([])}finally{u(!1)}},[]);m.useEffect(()=>{w()},[w]);const P=async s=>{try{const h=await N.getCampaignStats(s);R(h)}catch(h){b.error("Failed to load stats",h)}},q=async s=>{y(s.id);try{await N.startCampaign(s.id),o.success("Campanha iniciada!"),w()}catch(h){b.error("Failed to start campaign",h),o.error("Erro ao iniciar campanha")}finally{y(null)}},T=async s=>{y(s.id);try{await N.pauseCampaign(s.id),o.success("Campanha pausada"),w()}catch(h){b.error("Failed to pause campaign",h),o.error("Erro ao pausar campanha")}finally{y(null)}},J=async s=>{y(s.id);try{await N.resumeCampaign(s.id),o.success("Campanha retomada!"),w()}catch(h){b.error("Failed to resume campaign",h),o.error("Erro ao retomar campanha")}finally{y(null)}},_=async s=>{if(confirm("Tem certeza que deseja cancelar esta campanha?")){y(s.id);try{await N.cancelCampaign(s.id),o.success("Campanha cancelada"),w()}catch(h){b.error("Failed to cancel campaign",h),o.error("Erro ao cancelar campanha")}finally{y(null)}}},G=async s=>{y(s.id);try{const h=await N.getCampaignRecipients(s.id,"pending");o.success(`Processando: ${h.length} pendentes`),w(),C?.id===s.id&&await P(s.id)}catch(h){b.error("Failed to process campaign",h),o.error("Erro ao processar campanha")}finally{y(null)}},I=async s=>{A(s),await P(s.id)},L=s=>{const $={draft:{className:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-zinc-300",label:"Rascunho",icon:null},scheduled:{className:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",label:"Agendada",icon:e.jsx(Z,{className:"w-3 h-3"})},running:{className:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300",label:"Enviando",icon:e.jsx(oe,{className:"w-3 h-3 animate-spin"})},paused:{className:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",label:"Pausada",icon:e.jsx(de,{className:"w-3 h-3"})},completed:{className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",label:"Conclu√≠da",icon:e.jsx(ge,{className:"w-3 h-3"})},cancelled:{className:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300",label:"Cancelada",icon:e.jsx(Ee,{className:"w-3 h-3"})}}[s]||{className:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-zinc-300",label:s,icon:null};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${$.className}`,children:[$.icon,$.label]})};return c?e.jsx(xe,{}):e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Campanhas WhatsApp"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:"Gerencie suas campanhas de mensagens em massa"})]}),e.jsxs(d,{onClick:()=>r("/marketing/whatsapp/new"),children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),"Nova Campanha"]})]}),E.length===0?e.jsxs(v,{className:"p-12 text-center",children:[e.jsx(U,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Nenhuma campanha criada"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400 mb-6",children:"Crie sua primeira campanha de WhatsApp para alcan√ßar seus clientes"}),e.jsxs(d,{onClick:()=>r("/marketing/whatsapp/new"),children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),"Criar Campanha"]})]}):e.jsx("div",{className:"space-y-4",children:E.map(s=>e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:s.name}),L(s.status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-zinc-400",children:[e.jsxs("span",{children:[s.total_recipients," destinat√°rios"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[s.messages_sent," enviadas"]}),s.messages_delivered>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[s.messages_delivered," entregues"]})]}),s.messages_failed>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{className:"text-red-500",children:[s.messages_failed," falhas"]})]})]}),s.scheduled_at&&s.status==="scheduled"&&e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:[e.jsx(Z,{className:"w-4 h-4 inline mr-1"}),"Agendada para ",new Date(s.scheduled_at).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="draft"&&e.jsxs(d,{size:"sm",onClick:()=>q(s),disabled:f===s.id,children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"Iniciar"]}),s.status==="scheduled"&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{size:"sm",onClick:()=>q(s),disabled:f===s.id,children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"Iniciar Agora"]}),e.jsx(d,{size:"sm",variant:"secondary",onClick:()=>_(s),disabled:f===s.id,children:e.jsx(ie,{className:"w-4 h-4"})})]}),s.status==="running"&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{size:"sm",onClick:()=>G(s),disabled:f===s.id,title:"For√ßar processamento (√∫til se Celery n√£o est√° rodando)",children:[e.jsx(oe,{className:`w-4 h-4 mr-1 ${f===s.id?"animate-spin":""}`}),"Processar"]}),e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>T(s),disabled:f===s.id,children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Pausar"]})]}),s.status==="paused"&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{size:"sm",onClick:()=>J(s),disabled:f===s.id,children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"Retomar"]}),e.jsx(d,{size:"sm",variant:"secondary",onClick:()=>_(s),disabled:f===s.id,children:e.jsx(ie,{className:"w-4 h-4"})})]}),e.jsx(d,{size:"sm",variant:"secondary",onClick:()=>I(s),children:e.jsx(Le,{className:"w-4 h-4"})})]})]}),s.status==="running"&&s.total_recipients>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:"Progresso"}),e.jsxs("span",{children:[Math.round(s.messages_sent/s.total_recipients*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all",style:{width:`${s.messages_sent/s.total_recipients*100}%`}})})]})]},s.id))}),C&&p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(v,{className:"w-full max-w-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Estat√≠sticas da Campanha"}),e.jsx("button",{onClick:()=>{A(null),R(null)},className:"text-gray-400 hover:text-gray-600",children:"‚úï"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:p.name}),L(p.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:p.total_recipients})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Enviadas"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:p.messages_sent})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-600",children:"Entregues"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:p.messages_delivered})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-purple-600",children:"Lidas"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700",children:p.messages_read})]})]}),p.messages_failed>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-600",children:"Falhas"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:p.messages_failed})]}),e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Taxa de Entrega"}),e.jsxs("span",{className:"font-medium",children:[p.delivery_rate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Taxa de Leitura"}),e.jsxs("span",{className:"font-medium",children:[p.read_rate.toFixed(1),"%"]})]}),p.pending>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Pendentes"}),e.jsx("span",{className:"font-medium",children:p.pending})]})]}),p.started_at&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Iniciada em ",new Date(p.started_at).toLocaleString("pt-BR")]}),p.completed_at&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Conclu√≠da em ",new Date(p.completed_at).toLocaleString("pt-BR")]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(d,{variant:"secondary",onClick:()=>{A(null),R(null)},children:"Fechar"})})]})})]})};export{Oe as NewWhatsAppCampaignPage,Ue as WhatsAppCampaignsPage};
