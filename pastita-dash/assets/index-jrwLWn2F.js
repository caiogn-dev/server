import{j as e}from"./vendor-charts-o9Lo7m6Z.js";import{u as Z,r as a}from"./vendor-react-C2HNIXra.js";import{d as ee,b0 as n,l as b,a5 as te,X as c,a6 as O,a4 as x,h,af as se,ag as ae,E as re,W as l,b1 as w,aN as M,aO as A,ah as U}from"./feature-automation-CLWK1V5x.js";import"./index-DQDVHdIA.js";import"./vendor-utils-DaXQUBrP.js";import"./vendor-ui-B9rDAafI.js";import"./vendor-mui-DKuE-Kg_.js";const pe=()=>{const{storeId:V}=Z(),{storeId:B}=ee(),i=V||B,[v,L]=a.useState([]),[o,P]=a.useState(null),[q,_]=a.useState(!0),[C,G]=a.useState(""),[j,W]=a.useState(void 0),[z,X]=a.useState(""),[H,I]=a.useState(!1),[J,m]=a.useState(!1),[y,S]=a.useState(null),[D,p]=a.useState(null),[N,f]=a.useState(!1),[ie,u]=a.useState(null),K=a.useCallback(()=>({store:i||void 0,code:"",description:"",discount_type:"percentage",discount_value:0,min_purchase:0,max_discount:null,usage_limit:null,is_active:!0,valid_from:new Date().toISOString().split("T")[0],valid_until:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0]}),[i]),[s,r]=a.useState(K()),g=a.useCallback(async()=>{if(!i){_(!1);return}try{_(!0),u(null);const[t,d]=await Promise.all([n.getCoupons({store:i,search:C||void 0,is_active:j,discount_type:z||void 0}),n.getStats(i)]);L(t.results),P(d)}catch(t){b.error("Error loading coupons:",t),u("Erro ao carregar cupons")}finally{_(!1)}},[C,j,z,i]);a.useEffect(()=>{g()},[g]),a.useEffect(()=>{r(t=>({...t,store:i||void 0}))},[i]);const k=t=>{t?(S(t),r({code:t.code,description:t.description,discount_type:t.discount_type,discount_value:t.discount_value,min_purchase:t.min_purchase,max_discount:t.max_discount,usage_limit:t.usage_limit,is_active:t.is_active,valid_from:t.valid_from.split("T")[0],valid_until:t.valid_until.split("T")[0]})):(S(null),r({code:"",description:"",discount_type:"percentage",discount_value:0,min_purchase:0,max_discount:null,usage_limit:null,is_active:!0,valid_from:new Date().toISOString().split("T")[0],valid_until:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0]})),I(!0)},E=()=>{I(!1),S(null)},Q=async()=>{if(!i){u("Selecione uma loja antes de criar um cupom");return}try{f(!0),u(null);const t={...s,store:i};y?await n.updateCoupon(y.id,t):await n.createCoupon(t),E(),g()}catch(t){const d=t instanceof Error?t.message:"Erro ao salvar cupom";b.error("Error saving coupon:",t),u(d)}finally{f(!1)}},R=async t=>{try{await n.toggleActive(t.id),g()}catch(d){b.error("Error toggling coupon:",d)}},Y=async()=>{if(D)try{f(!0),await n.deleteCoupon(D.id),m(!1),p(null),g()}catch(t){b.error("Error deleting coupon:",t)}finally{f(!1)}},$=t=>{const d=typeof t=="number"?t:Number.parseFloat(String(t??"0"));return Number.isNaN(d)?"0.00":d.toFixed(2)},T=t=>t.discount_type==="percentage"?`${t.discount_value}%`:`R$ ${$(t.discount_value)}`,F=t=>new Date(t).toLocaleDateString("pt-BR");return q&&v.length===0?e.jsx(te,{}):e.jsxs("div",{className:"p-4 md:p-6 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 dark:text-white",children:"Cupons de Desconto"}),e.jsx("p",{className:"text-sm md:text-base text-gray-500 dark:text-zinc-400",children:"Gerencie os cupons de desconto da loja"})]}),e.jsxs(c,{onClick:()=>k(),className:"w-full sm:w-auto",children:[e.jsx(O,{className:"w-5 h-5 mr-2"}),"Novo Cupom"]})]}),o&&e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4",children:[e.jsx(x,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/40 rounded-lg shrink-0",children:e.jsx(h,{className:"w-5 h-5 md:w-6 md:h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"ml-3 md:ml-4 min-w-0",children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-500 dark:text-zinc-400 truncate",children:"Total"}),e.jsx("p",{className:"text-lg md:text-2xl font-bold text-gray-900 dark:text-white",children:o.total})]})]})}),e.jsx(x,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/40 rounded-lg shrink-0",children:e.jsx(se,{className:"w-5 h-5 md:w-6 md:h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"ml-3 md:ml-4 min-w-0",children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-500 dark:text-zinc-400 truncate",children:"Ativos"}),e.jsx("p",{className:"text-lg md:text-2xl font-bold text-gray-900 dark:text-white",children:o.active})]})]})}),e.jsx(x,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-700 rounded-lg shrink-0",children:e.jsx(ae,{className:"w-5 h-5 md:w-6 md:h-6 text-gray-600 dark:text-zinc-400"})}),e.jsxs("div",{className:"ml-3 md:ml-4 min-w-0",children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-500 dark:text-zinc-400 truncate",children:"Inativos"}),e.jsx("p",{className:"text-lg md:text-2xl font-bold text-gray-900 dark:text-white",children:o.inactive})]})]})}),e.jsx(x,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/40 rounded-lg shrink-0",children:e.jsx(h,{className:"w-5 h-5 md:w-6 md:h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"ml-3 md:ml-4 min-w-0",children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-500 dark:text-zinc-400 truncate",children:"Usos Totais"}),e.jsx("p",{className:"text-lg md:text-2xl font-bold text-gray-900 dark:text-white",children:o.total_usage})]})]})})]}),e.jsx(x,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 md:gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(l,{type:"text",placeholder:"Buscar por código...",value:C,onChange:t=>G(t.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:flex gap-2 sm:gap-3",children:[e.jsxs("select",{value:j===void 0?"":String(j),onChange:t=>W(t.target.value===""?void 0:t.target.value==="true"),className:"px-2 sm:px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Status"}),e.jsx("option",{value:"true",children:"Ativos"}),e.jsx("option",{value:"false",children:"Inativos"})]}),e.jsxs("select",{value:z,onChange:t=>X(t.target.value),className:"px-2 sm:px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Tipo"}),e.jsx("option",{value:"percentage",children:"%"}),e.jsx("option",{value:"fixed",children:"R$"})]})]})]})}),e.jsxs(x,{children:[e.jsx("div",{className:"block md:hidden divide-y divide-gray-200",children:v.map(t=>e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5 text-gray-400 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-mono font-bold text-gray-900 dark:text-white",children:t.code}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400",children:t.description})]})]}),e.jsx("button",{onClick:()=>R(t),className:"focus:outline-none shrink-0",children:e.jsx(w,{variant:t.is_active&&t.is_valid_now?"success":"danger",children:t.is_active?t.is_valid_now?"Ativo":"Expirado":"Inativo"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-zinc-400",children:"Desconto:"}),e.jsx(w,{variant:t.discount_type==="percentage"?"info":"success",className:"ml-1",children:T(t)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-zinc-400",children:"Uso:"}),e.jsxs("span",{className:"ml-1 text-gray-700 dark:text-zinc-300",children:[t.used_count,t.usage_limit&&` / ${t.usage_limit}`]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-zinc-400",children:"Mín:"}),e.jsx("span",{className:"ml-1 text-gray-700 dark:text-zinc-300",children:Number(t.min_purchase||0)>0?`R$ ${$(t.min_purchase)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-zinc-400",children:"Até:"}),e.jsx("span",{className:"ml-1 text-gray-700 dark:text-zinc-300",children:F(t.valid_until)})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-1 pt-2 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>k(t),className:"p-2 text-primary-600 hover:bg-primary-50 rounded-lg",children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{p(t),m(!0)},className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 rounded-lg",children:e.jsx(A,{className:"w-5 h-5"})})]})]},t.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-black",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-zinc-400 uppercase tracking-wider",children:"Código"}),e.jsx("th",{className:"px-4 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-zinc-400 uppercase tracking-wider",children:"Desconto"}),e.jsx("th",{className:"px-4 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-zinc-400 uppercase tracking-wider",children:"Mín. Compra"}),e.jsx("th",{className:"px-4 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-zinc-400 uppercase tracking-wider",children:"Uso"}),e.jsx("th",{className:"px-4 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-zinc-400 uppercase tracking-wider",children:"Validade"}),e.jsx("th",{className:"px-4 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-zinc-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 lg:px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-zinc-400 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-zinc-900 divide-y divide-gray-200",children:v.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-zinc-700 dark:bg-black",children:[e.jsx("td",{className:"px-4 lg:px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{className:"w-5 h-5 text-gray-400 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-mono font-bold text-gray-900 dark:text-white",children:t.code}),t.description&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-zinc-400 max-w-[200px] truncate",children:t.description})]})]})}),e.jsx("td",{className:"px-4 lg:px-6 py-4 whitespace-nowrap",children:e.jsx(w,{variant:t.discount_type==="percentage"?"info":"success",children:T(t)})}),e.jsx("td",{className:"px-4 lg:px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-zinc-400",children:Number(t.min_purchase||0)>0?`R$ ${$(t.min_purchase)}`:"-"}),e.jsxs("td",{className:"px-4 lg:px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-zinc-400",children:[t.used_count,t.usage_limit&&` / ${t.usage_limit}`]}),e.jsxs("td",{className:"px-4 lg:px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-zinc-400",children:[e.jsx("div",{children:F(t.valid_from)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-zinc-400",children:["até ",F(t.valid_until)]})]}),e.jsx("td",{className:"px-4 lg:px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>R(t),className:"focus:outline-none",children:e.jsx(w,{variant:t.is_active&&t.is_valid_now?"success":"danger",children:t.is_active?t.is_valid_now?"Ativo":"Expirado":"Inativo"})})}),e.jsx("td",{className:"px-4 lg:px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>k(t),className:"p-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Editar",children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{p(t),m(!0)},className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 rounded-lg transition-colors",title:"Excluir",children:e.jsx(A,{className:"w-5 h-5"})})]})})]},t.id))})]})}),v.length===0&&e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx(h,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"Nenhum cupom encontrado"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-zinc-400",children:"Comece criando um novo cupom de desconto."}),e.jsx("div",{className:"mt-6",children:e.jsxs(c,{onClick:()=>k(),children:[e.jsx(O,{className:"w-5 h-5 mr-2"}),"Novo Cupom"]})})]})]}),e.jsx(U,{isOpen:H,onClose:E,title:y?"Editar Cupom":"Novo Cupom",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Código do Cupom *"}),e.jsx(l,{type:"text",value:s.code,onChange:t=>r({...s,code:t.target.value.toUpperCase()}),placeholder:"Ex: DESCONTO10",className:"font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Descrição"}),e.jsx(l,{type:"text",value:s.description||"",onChange:t=>r({...s,description:t.target.value}),placeholder:"Descrição do cupom"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Tipo de Desconto *"}),e.jsxs("select",{value:s.discount_type,onChange:t=>r({...s,discount_type:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"percentage",children:"Porcentagem (%)"}),e.jsx("option",{value:"fixed",children:"Valor Fixo (R$)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Valor do Desconto *"}),e.jsx(l,{type:"number",value:s.discount_value,onChange:t=>r({...s,discount_value:parseFloat(t.target.value)||0}),min:"0",step:s.discount_type==="percentage"?"1":"0.01"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Compra Mínima (R$)"}),e.jsx(l,{type:"number",value:s.min_purchase||0,onChange:t=>r({...s,min_purchase:parseFloat(t.target.value)||0}),min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Desconto Máximo (R$)"}),e.jsx(l,{type:"number",value:s.max_discount||"",onChange:t=>r({...s,max_discount:t.target.value?parseFloat(t.target.value):null}),min:"0",step:"0.01",placeholder:"Sem limite"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Limite de Uso"}),e.jsx(l,{type:"number",value:s.usage_limit||"",onChange:t=>r({...s,usage_limit:t.target.value?parseInt(t.target.value):null}),min:"0",placeholder:"Sem limite"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Válido a partir de *"}),e.jsx(l,{type:"date",value:s.valid_from,onChange:t=>r({...s,valid_from:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Válido até *"}),e.jsx(l,{type:"date",value:s.valid_until,onChange:t=>r({...s,valid_until:t.target.value})})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:s.is_active,onChange:t=>r({...s,is_active:t.target.checked}),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 dark:border-zinc-700 rounded"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Cupom ativo"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(c,{variant:"secondary",onClick:E,children:"Cancelar"}),e.jsx(c,{onClick:Q,disabled:N||!s.code||!s.discount_value,children:N?"Salvando...":y?"Salvar":"Criar"})]})]})}),e.jsx(U,{isOpen:J,onClose:()=>{m(!1),p(null)},title:"Excluir Cupom",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-zinc-400",children:["Tem certeza que deseja excluir o cupom ",e.jsx("strong",{children:D?.code}),"? Esta ação não pode ser desfeita."]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(c,{variant:"secondary",onClick:()=>{m(!1),p(null)},children:"Cancelar"}),e.jsx(c,{variant:"danger",onClick:Y,disabled:N,children:N?"Excluindo...":"Excluir"})]})]})})]})};export{pe as CouponsPage};
