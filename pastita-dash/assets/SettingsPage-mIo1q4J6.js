import{j as e}from"./vendor-charts-o9Lo7m6Z.js";import{r as d}from"./vendor-react-C2HNIXra.js";import{u as A,a0 as E,a4 as x,W as g,X as w,a5 as I,K as v,R as l,Y as K,Z as k}from"./feature-automation-CLWK1V5x.js";import"./vendor-utils-DaXQUBrP.js";import"./vendor-ui-B9rDAafI.js";import"./vendor-mui-DKuE-Kg_.js";const P=({checked:n,onChange:h,disabled:c=!1,label:m})=>e.jsxs("label",{className:`relative inline-flex items-center ${c?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:n,onChange:f=>h(f.target.checked),disabled:c,"aria-label":m}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white dark:bg-zinc-900 after:border-gray-300 dark:border-zinc-700 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-500"})]}),R=()=>{const{user:n,setAuth:h}=A(),[c,m]=d.useState(!1),[f,y]=d.useState(!0),[N,b]=d.useState(!1),[o,u]=d.useState(null),[t,p]=d.useState({oldPassword:"",newPassword:"",confirmPassword:""}),_=async s=>{if(s.preventDefault(),t.newPassword!==t.confirmPassword){l.error("As senhas não coincidem");return}if(t.newPassword.length<8){l.error("A nova senha deve ter pelo menos 8 caracteres");return}m(!0);try{const i=await K.changePassword(t.oldPassword,t.newPassword);h(i.token,n),l.success("Senha alterada com sucesso!"),p({oldPassword:"",newPassword:"",confirmPassword:""})}catch(i){l.error(k(i))}finally{m(!1)}},S=async()=>{y(!0);try{const s=await v.getPreferences();u(s)}catch{l.error("Não foi possível carregar as preferências de notificação")}finally{y(!1)}};d.useEffect(()=>{S()},[]);const j=(s,i)=>{u(a=>{if(!a)return a;const r={...a,[s]:i};return s==="email_enabled"&&!i&&(r.email_messages=!1,r.email_orders=!1,r.email_payments=!1,r.email_system=!1),s==="push_enabled"&&!i&&(r.push_messages=!1,r.push_orders=!1,r.push_payments=!1,r.push_system=!1),s==="inapp_enabled"&&!i&&(r.inapp_sound=!1),r})},C=async()=>{if(o){b(!0);try{const s=await v.updatePreferences(o);u(s),l.success("Preferências de notificação salvas!")}catch(s){l.error(k(s))}finally{b(!1)}}},z=[{id:"email",title:"Email",description:"Alertas enviados para o email cadastrado.",enabledKey:"email_enabled",options:[{key:"email_messages",label:"Mensagens",description:"Novas mensagens e respostas do atendimento."},{key:"email_orders",label:"Pedidos",description:"Mudanças de status e atualizações de pedidos."},{key:"email_payments",label:"Pagamentos",description:"Confirmações, falhas e reembolsos."},{key:"email_system",label:"Sistema",description:"Avisos e alertas críticos do painel."}]},{id:"push",title:"Push",description:"Notificações rápidas no navegador.",enabledKey:"push_enabled",options:[{key:"push_messages",label:"Mensagens",description:"Atualizações de conversas em tempo real."},{key:"push_orders",label:"Pedidos",description:"Novos pedidos e alterações de status."},{key:"push_payments",label:"Pagamentos",description:"Eventos de pagamento importantes."},{key:"push_system",label:"Sistema",description:"Alertas do sistema e incidentes."}]},{id:"inapp",title:"Painel",description:"Alertas dentro do próprio dashboard.",enabledKey:"inapp_enabled",options:[{key:"inapp_sound",label:"Som de notificação",description:"Tocar som ao receber um novo alerta."}]}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(E,{title:"Configurações",subtitle:"Gerencie suas preferências e segurança"}),e.jsx(x,{title:"Informações do Usuário",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 dark:text-zinc-400",children:"Usuário"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:n?.username})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 dark:text-zinc-400",children:"Email"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:n?.email||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 dark:text-zinc-400",children:"Nome"}),e.jsxs("p",{className:"text-gray-900 dark:text-white",children:[n?.first_name||"-"," ",n?.last_name||""]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 dark:text-zinc-400",children:"Tipo"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:n?.is_superuser?"Superusuário":n?.is_staff?"Staff":"Usuário"})]})]})}),e.jsx(x,{title:"Alterar Senha",children:e.jsxs("form",{onSubmit:_,className:"space-y-4 max-w-md",children:[e.jsx(g,{label:"Senha Atual",type:"password",required:!0,value:t.oldPassword,onChange:s=>p({...t,oldPassword:s.target.value})}),e.jsx(g,{label:"Nova Senha",type:"password",required:!0,value:t.newPassword,onChange:s=>p({...t,newPassword:s.target.value}),helperText:"Mínimo de 8 caracteres"}),e.jsx(g,{label:"Confirmar Nova Senha",type:"password",required:!0,value:t.confirmPassword,onChange:s=>p({...t,confirmPassword:s.target.value})}),e.jsx(w,{type:"submit",isLoading:c,children:"Alterar Senha"})]})}),e.jsx(x,{title:"Preferências de Notificação",subtitle:"Defina onde deseja receber alertas do sistema",actions:e.jsx(w,{onClick:C,isLoading:N,disabled:!o,children:"Salvar preferências"}),children:f?e.jsxs("div",{className:"py-10",children:[e.jsx(I,{size:"lg"}),e.jsx("p",{className:"mt-3 text-center text-sm text-gray-500 dark:text-zinc-400",children:"Carregando preferências..."})]}):o?e.jsx("div",{className:"space-y-6",children:z.map(s=>{const i=o[s.enabledKey];return e.jsxs("div",{className:"rounded-lg border border-gray-100 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:s.description})]}),e.jsx(P,{label:`Ativar ${s.title}`,checked:i,onChange:a=>j(s.enabledKey,a)})]}),s.options.length>0&&e.jsx("div",{className:"mt-4 space-y-3",children:s.options.map(a=>e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:a.label}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400",children:a.description})]}),e.jsx(P,{label:`${s.title} - ${a.label}`,checked:!!o[a.key],onChange:r=>j(a.key,r),disabled:!i})]},a.key))})]},s.id)})}):e.jsx("div",{className:"text-sm text-red-500",children:"Não foi possível carregar as preferências de notificação."})}),e.jsx(x,{title:"Informações da API",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 dark:text-zinc-400",children:"Base URL"}),e.jsx("p",{className:"text-gray-900 dark:text-white font-mono text-sm",children:"http://localhost:8000/api/v1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 dark:text-zinc-400",children:"Documentação"}),e.jsxs("div",{className:"flex gap-4 mt-1",children:[e.jsx("a",{href:"http://localhost:8000/api/docs/",target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:text-primary-700",children:"Swagger UI"}),e.jsx("a",{href:"http://localhost:8000/api/redoc/",target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:text-primary-700",children:"ReDoc"})]})]})]})})]})};export{R as SettingsPage};
