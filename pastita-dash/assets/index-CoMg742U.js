import{j as e}from"./vendor-charts-o9Lo7m6Z.js";import{r as o,e as I,u as te}from"./vendor-react-C2HNIXra.js";import{G as i,w as E,x as L,i as F,aL as se,aM as K,aN as re,aO as P,z as O,aP as J,aQ as G,aR as U,D as le,aS as xe,r as me,aI as H,t as he,v as V,aT as ue,aU as be,aa as q,aV as ae,aj as ne,ab as C,aW as pe,ax as ge,J as je,a6 as Q,E as ze,ak as fe,ac as W,aX as ve,U as ke,aY as X,k as B,aZ as Ne,e as we,C as ye,a_ as Ce,a$ as Y,af as M}from"./feature-automation-CLWK1V5x.js";import{u as _e}from"./index-DQDVHdIA.js";import"./vendor-utils-DaXQUBrP.js";import"./vendor-ui-B9rDAafI.js";import"./vendor-mui-DKuE-Kg_.js";const Z={kimi:{bg:"bg-purple-100 dark:bg-purple-900/30",text:"text-purple-700 dark:text-purple-300",border:"border-purple-200 dark:border-purple-800"},openai:{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-300",border:"border-green-200 dark:border-green-800"},anthropic:{bg:"bg-orange-100 dark:bg-orange-900/30",text:"text-orange-700 dark:text-orange-300",border:"border-orange-200 dark:border-orange-800"},ollama:{bg:"bg-blue-100 dark:bg-blue-900/30",text:"text-blue-700 dark:text-blue-300",border:"border-blue-200 dark:border-blue-800"}},ee={active:{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-300",dot:"bg-green-500"},inactive:{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-700 dark:text-gray-300",dot:"bg-gray-400"},draft:{bg:"bg-yellow-100 dark:bg-yellow-900/30",text:"text-yellow-700 dark:text-yellow-300",dot:"bg-yellow-500"}},Se={kimi:"Kimi",openai:"OpenAI",anthropic:"Anthropic",ollama:"Ollama"},Ae={active:"Ativo",inactive:"Inativo",draft:"Rascunho"},De=({agent:a,onEdit:l,onDelete:s,onToggleStatus:u,onTest:b,onViewConversations:x})=>{const h=Z[a.provider]||Z.kimi,n=ee[a.status]||ee.draft;return e.jsxs("div",{className:i("bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800","shadow-sm hover:shadow-md transition-all duration-200","overflow-hidden"),children:[e.jsxs("div",{className:"p-5 border-b border-zinc-100 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:i("w-10 h-10 rounded-lg flex items-center justify-center",h.bg,h.border,"border"),children:e.jsx(E,{className:i("w-5 h-5",h.text)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-zinc-900 dark:text-white text-lg",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:i("px-2 py-0.5 rounded-full text-xs font-medium",h.bg,h.text),children:Se[a.provider]}),e.jsx("span",{className:"text-zinc-400 dark:text-zinc-500 text-xs",children:a.model_name})]})]})]}),e.jsxs("div",{className:i("flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",n.bg,n.text),children:[e.jsx("span",{className:i("w-1.5 h-1.5 rounded-full",n.dot)}),Ae[a.status]]})]}),a.description&&e.jsx("p",{className:"mt-3 text-sm text-zinc-600 dark:text-zinc-400 line-clamp-2",children:a.description})]}),e.jsxs("div",{className:"px-5 py-3 bg-zinc-50 dark:bg-zinc-800/50 grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 mb-0.5",children:"Temperatura"}),e.jsx("div",{className:"font-semibold text-zinc-900 dark:text-white",children:a.temperature})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 mb-0.5",children:"Max Tokens"}),e.jsx("div",{className:"font-semibold text-zinc-900 dark:text-white",children:a.max_tokens})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 mb-0.5",children:"Memória"}),e.jsx("div",{className:i("font-semibold",a.use_memory?"text-green-600 dark:text-green-400":"text-zinc-400"),children:a.use_memory?"Ativa":"Desativada"})]})]}),e.jsxs("div",{className:"p-3 border-t border-zinc-100 dark:border-zinc-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[b&&e.jsx("button",{onClick:()=>b(a.id),className:i("p-2 rounded-lg transition-colors","text-zinc-500 hover:text-primary-600 hover:bg-primary-50","dark:text-zinc-400 dark:hover:text-primary-400 dark:hover:bg-primary-900/30"),title:"Testar agente",children:e.jsx(L,{className:"w-5 h-5"})}),x&&e.jsx("button",{onClick:()=>x(a.id),className:i("p-2 rounded-lg transition-colors","text-zinc-500 hover:text-blue-600 hover:bg-blue-50","dark:text-zinc-400 dark:hover:text-blue-400 dark:hover:bg-blue-900/30"),title:"Ver conversas",children:e.jsx(F,{className:"w-5 h-5"})}),u&&e.jsx("button",{onClick:()=>u(a.id),className:i("p-2 rounded-lg transition-colors",a.status==="active"?"text-yellow-500 hover:text-yellow-600 hover:bg-yellow-50 dark:hover:bg-yellow-900/30":"text-green-500 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-900/30"),title:a.status==="active"?"Desativar":"Ativar",children:a.status==="active"?e.jsx(se,{className:"w-5 h-5"}):e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[l&&e.jsx("button",{onClick:()=>l(a.id),className:i("p-2 rounded-lg transition-colors","text-zinc-500 hover:text-zinc-700 hover:bg-zinc-100","dark:text-zinc-400 dark:hover:text-zinc-200 dark:hover:bg-zinc-800"),title:"Editar",children:e.jsx(re,{className:"w-5 h-5"})}),s&&e.jsx("button",{onClick:()=>s(a.id),className:i("p-2 rounded-lg transition-colors","text-zinc-500 hover:text-red-600 hover:bg-red-50","dark:text-zinc-400 dark:hover:text-red-400 dark:hover:bg-red-900/30"),title:"Excluir",children:e.jsx(P,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"px-5 py-2 bg-zinc-50 dark:bg-zinc-800/30 border-t border-zinc-100 dark:border-zinc-800",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-zinc-400 dark:text-zinc-500",children:[e.jsx(O,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:["Atualizado em ",new Date(a.updated_at).toLocaleDateString("pt-BR")]})]})})]})},ie=({agent:a,whatsappAccounts:l=[],onSubmit:s,onCancel:u,isLoading:b=!1})=>{const[x,h]=o.useState("basic"),[n,z]=o.useState(a||J),[p,N]=o.useState({}),[v,w]=o.useState(""),k=!!a?.id;o.useEffect(()=>{(async()=>{const f=await G(n.provider||"kimi");f?.base_url&&w(f.base_url)})()},[n.provider]),o.useEffect(()=>{a&&z({...J,...a})},[a]);const _=o.useCallback(async r=>{const f=U[r],R=(await G(r))?.base_url||"";z(t=>({...t,provider:r,model_name:f.models[0],base_url:R})),R&&w(R)},[]),g=(r,f)=>{z(y=>({...y,[r]:f})),p[r]&&N(y=>({...y,[r]:""}))},S=()=>{const r={};return n.name?.trim()||(r.name="Nome é obrigatório"),n.system_prompt?.trim()||(r.system_prompt="System prompt é obrigatório"),N(r),Object.keys(r).length===0},A=r=>{if(r.preventDefault(),S()){const f={name:n.name||"",description:n.description,provider:n.provider||"kimi",model_name:n.model_name||"",base_url:n.base_url,temperature:n.temperature,max_tokens:n.max_tokens,timeout:n.timeout,system_prompt:n.system_prompt,context_prompt:n.context_prompt,status:n.status,use_memory:n.use_memory,memory_ttl:n.memory_ttl,accounts:n.accounts};s(f)}},m=[{id:"basic",label:"Informações",icon:xe},{id:"model",label:"Modelo",icon:E},{id:"prompts",label:"Prompts",icon:me},{id:"accounts",label:"Contas",icon:H}],j=U[n.provider||"kimi"];return e.jsxs("form",{onSubmit:A,className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-zinc-200 dark:border-zinc-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-zinc-900 dark:text-white",children:k?"Editar Agente":"Novo Agente"}),e.jsx("button",{type:"button",onClick:u,className:"p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:e.jsx(le,{className:"w-5 h-5 text-zinc-500"})})]}),e.jsx("div",{className:"flex border-b border-zinc-200 dark:border-zinc-700 px-6",children:m.map(r=>e.jsxs("button",{type:"button",onClick:()=>h(r.id),className:i("flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors",x===r.id?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"),children:[e.jsx(r.icon,{className:"w-4 h-4"}),r.label]},r.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[x==="basic"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Nome do Agente *"}),e.jsx("input",{type:"text",value:n.name||"",onChange:r=>g("name",r.target.value),placeholder:"Ex: Assistente de Vendas",className:i("w-full px-4 py-2.5 rounded-lg border transition-colors","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white placeholder-zinc-400",p.name?"border-red-300 dark:border-red-600 focus:ring-red-500":"border-zinc-200 dark:border-zinc-700 focus:ring-primary-500")}),p.name&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Descrição"}),e.jsx("textarea",{value:n.description||"",onChange:r=>g("description",r.target.value),placeholder:"Descreva a função deste agente...",rows:3,className:i("w-full px-4 py-2.5 rounded-lg border transition-colors resize-none","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white placeholder-zinc-400","border-zinc-200 dark:border-zinc-700 focus:ring-primary-500")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Status"}),e.jsxs("select",{value:n.status||"draft",onChange:r=>g("status",r.target.value),className:i("w-full px-4 py-2.5 rounded-lg border transition-colors","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white","border-zinc-200 dark:border-zinc-700 focus:ring-primary-500"),children:[e.jsx("option",{value:"draft",children:"Rascunho"}),e.jsx("option",{value:"active",children:"Ativo"}),e.jsx("option",{value:"inactive",children:"Inativo"})]})]})]}),x==="model"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Provedor *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(U).map(([r,f])=>e.jsxs("button",{type:"button",onClick:()=>_(r),className:i("px-4 py-3 rounded-lg border-2 text-left transition-all",n.provider===r?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-zinc-200 dark:border-zinc-700 hover:border-zinc-300"),children:[e.jsx("div",{className:"font-medium text-zinc-900 dark:text-white",children:f.name}),e.jsxs("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-0.5",children:[f.models.length," modelos"]})]},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Modelo"}),e.jsx("select",{value:n.model_name||"",onChange:r=>g("model_name",r.target.value),className:i("w-full px-4 py-2.5 rounded-lg border transition-colors","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white","border-zinc-200 dark:border-zinc-700 focus:ring-primary-500"),children:j.models.map(r=>e.jsx("option",{value:r,children:r},r))}),n.provider==="kimi"&&e.jsx("p",{className:"mt-1 text-xs text-blue-600 dark:text-blue-400",children:"ℹ️ Kimi usa API no estilo Anthropic (backend gerencia)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:["Base URL",e.jsx("span",{className:"ml-2 text-xs text-blue-600 dark:text-blue-400 font-normal",children:"(carregado do backend)"})]}),e.jsx("input",{type:"url",value:n.base_url||v||"",readOnly:!0,className:i("w-full px-4 py-2.5 rounded-lg border transition-colors","bg-zinc-100 dark:bg-zinc-800","text-zinc-600 dark:text-zinc-400","border-zinc-200 dark:border-zinc-700","cursor-not-allowed")}),e.jsx("p",{className:"mt-1 text-xs text-zinc-500",children:"Esta URL é configurada automaticamente pelo backend para garantir compatibilidade com a API Anthropic."})]}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Nota:"})," A API Key é configurada no backend pelo administrador do sistema.",j.requiresApiKey?"Entre em contato com o suporte para configurar a API Key.":"Este provedor não requer API Key."]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:["Temperatura: ",n.temperature]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:n.temperature||.7,onChange:r=>g("temperature",parseFloat(r.target.value)),className:"w-full accent-primary-500"}),e.jsxs("div",{className:"flex justify-between text-xs text-zinc-400 mt-1",children:[e.jsx("span",{children:"Preciso"}),e.jsx("span",{children:"Criativo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Max Tokens"}),e.jsx("input",{type:"number",min:"100",max:"128000",step:"100",value:n.max_tokens||32768,onChange:r=>g("max_tokens",parseInt(r.target.value)),className:i("w-full px-4 py-2.5 rounded-lg border transition-colors","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white","border-zinc-200 dark:border-zinc-700")}),n.model_name==="kimi-for-coding"&&e.jsx("p",{className:"mt-1 text-xs text-zinc-500",children:"Máx: 32768 para kimi-for-coding"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Timeout (segundos)"}),e.jsx("input",{type:"number",min:"5",max:"120",value:n.timeout||30,onChange:r=>g("timeout",parseInt(r.target.value)),className:i("w-full px-4 py-2.5 rounded-lg border transition-colors","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white","border-zinc-200 dark:border-zinc-700")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"TTL da Memória (segundos)"}),e.jsx("input",{type:"number",min:"60",max:"86400",step:"60",value:n.memory_ttl||3600,onChange:r=>g("memory_ttl",parseInt(r.target.value)),disabled:!n.use_memory,className:i("w-full px-4 py-2.5 rounded-lg border transition-colors","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white","border-zinc-200 dark:border-zinc-700","disabled:opacity-50")})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-zinc-900 dark:text-white",children:"Usar Memória de Contexto"}),e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Mantém histórico de conversas no Redis"})]}),e.jsx("button",{type:"button",onClick:()=>g("use_memory",!n.use_memory),className:i("relative w-12 h-6 rounded-full transition-colors",n.use_memory?"bg-primary-500":"bg-zinc-300 dark:bg-zinc-600"),children:e.jsx("span",{className:i("absolute top-0.5 w-5 h-5 rounded-full bg-white shadow-sm transition-transform",n.use_memory?"translate-x-6":"translate-x-0.5")})})]})]}),x==="prompts"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"System Prompt *"}),e.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mb-2",children:"Define a personalidade e comportamento base do agente"}),e.jsx("textarea",{value:n.system_prompt||"",onChange:r=>g("system_prompt",r.target.value),placeholder:"Você é um assistente...",rows:8,className:i("w-full px-4 py-3 rounded-lg border transition-colors resize-none font-mono text-sm","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white placeholder-zinc-400",p.system_prompt?"border-red-300 dark:border-red-600":"border-zinc-200 dark:border-zinc-700")}),p.system_prompt&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.system_prompt})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Contexto Adicional"}),e.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mb-2",children:"Informações adicionais sobre o negócio, produtos, políticas, etc."}),e.jsx("textarea",{value:n.context_prompt||"",onChange:r=>g("context_prompt",r.target.value),placeholder:"Informações sobre o cardápio, horários de funcionamento...",rows:8,className:i("w-full px-4 py-3 rounded-lg border transition-colors resize-none font-mono text-sm","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white placeholder-zinc-400","border-zinc-200 dark:border-zinc-700")})]}),e.jsxs("div",{className:"p-4 bg-zinc-100 dark:bg-zinc-800 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Preview do Prompt Completo"}),e.jsxs("pre",{className:"text-xs text-zinc-600 dark:text-zinc-400 whitespace-pre-wrap font-mono",children:[n.system_prompt,n.context_prompt?`

${n.context_prompt}`:""]})]})]}),x==="accounts"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Contas WhatsApp Associadas"}),e.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mb-4",children:"Selecione as contas WhatsApp que este agente irá atender"}),l.length===0?e.jsxs("div",{className:"p-8 text-center bg-zinc-50 dark:bg-zinc-800/50 rounded-lg",children:[e.jsx(H,{className:"w-12 h-12 mx-auto text-zinc-300 dark:text-zinc-600 mb-3"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Nenhuma conta WhatsApp cadastrada"})]}):e.jsx("div",{className:"space-y-2",children:l.map(r=>e.jsxs("label",{className:i("flex items-center gap-3 p-4 rounded-lg border cursor-pointer transition-colors",n.accounts?.includes(r.id)?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-800"),children:[e.jsx("input",{type:"checkbox",checked:n.accounts?.includes(r.id)||!1,onChange:f=>{const y=f.target.checked?[...n.accounts||[],r.id]:(n.accounts||[]).filter(R=>R!==r.id);g("accounts",y)},className:"w-4 h-4 rounded border-zinc-300 text-primary-600 focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-zinc-900 dark:text-white",children:r.name}),e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:r.phone_number})]})]},r.id))})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-zinc-200 dark:border-zinc-700",children:[e.jsx("button",{type:"button",onClick:u,disabled:b,className:i("px-4 py-2 rounded-lg font-medium transition-colors","text-zinc-700 dark:text-zinc-300","hover:bg-zinc-100 dark:hover:bg-zinc-800","disabled:opacity-50"),children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:b,className:i("px-6 py-2 rounded-lg font-medium transition-colors","bg-primary-600 hover:bg-primary-700 text-white","disabled:opacity-50 disabled:cursor-not-allowed"),children:b?"Salvando...":k?"Salvar":"Criar Agente"})]})]})},Te=({stats:a,isLoading:l})=>{const s=[{label:"Conversas Totais",value:a.total_conversations,icon:F,color:"text-blue-500 bg-blue-100 dark:bg-blue-900/30"},{label:"Mensagens Totais",value:a.total_messages,icon:he,color:"text-green-500 bg-green-100 dark:bg-green-900/30"},{label:"Tempo Médio de Resposta",value:`${Math.round(a.avg_response_time_ms)}ms`,icon:O,color:"text-yellow-500 bg-yellow-100 dark:bg-yellow-900/30"},{label:"Sessões Ativas",value:a.active_sessions,icon:V,color:"text-purple-500 bg-purple-100 dark:bg-purple-900/30"}];return l?e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((u,b)=>e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl p-5 border border-zinc-200 dark:border-zinc-800 animate-pulse",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-zinc-200 dark:bg-zinc-700 mb-3"}),e.jsx("div",{className:"h-8 w-20 bg-zinc-200 dark:bg-zinc-700 rounded mb-2"}),e.jsx("div",{className:"h-4 w-24 bg-zinc-100 dark:bg-zinc-800 rounded"})]},b))}):e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:s.map((u,b)=>e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl p-5 border border-zinc-200 dark:border-zinc-800 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:i("w-10 h-10 rounded-lg flex items-center justify-center mb-3",u.color),children:e.jsx(u.icon,{className:"w-5 h-5"})}),e.jsx("div",{className:"text-2xl font-bold text-zinc-900 dark:text-white mb-1",children:u.value}),e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:u.label})]},b))})},T={log:(a,l,s)=>{console.log(`[AgentChatTest][${a}] ${l}`,s||"")},error:(a,l,s)=>{console.error(`[AgentChatTest][${a}] ${l}`,s||"")},warn:(a,l,s)=>{console.warn(`[AgentChatTest][${a}] ${l}`,s||"")}},ce=({agentName:a,agentId:l,onSendMessage:s,onClearChat:u,initialSessionId:b})=>{const[x,h]=o.useState([]),[n,z]=o.useState(""),[p,N]=o.useState(!1),[v,w]=o.useState(b),[k,_]=o.useState(!1),[g,S]=o.useState("connected"),A=o.useRef(null),m=o.useRef(null);T.log("Init","Component mounted",{agentId:l,initialSessionId:b});const j=o.useCallback(()=>{A.current?.scrollIntoView({behavior:"smooth"})},[]);o.useEffect(()=>{j()},[x,j]);const r=async t=>{if(t?.preventDefault(),!n.trim()||p){T.warn("Submit","Empty message or already loading");return}if(!l&&!s){T.error("Submit","No agentId or onSendMessage provided");const d={id:`error-${Date.now()}`,role:"error",content:"Erro de configuração: ID do agente não fornecido",timestamp:new Date,errorDetails:{message:"Agent ID missing"}};h(D=>[...D,d]);return}const c={id:`user-${Date.now()}`,role:"user",content:n.trim(),timestamp:new Date};h(d=>[...d,c]),z(""),N(!0),S("loading"),T.log("Submit","Sending message",{messageLength:c.content.length,sessionId:v,agentId:l});try{let d;if(s)T.log("Submit","Using provided onSendMessage handler"),d=await s(c.content,v);else if(l)T.log("Submit","Using agentsService.processMessage",{agentId:l}),d=await C.processMessage(l,{message:c.content,session_id:v,context:{test:!0,source:"AgentChatTest"}});else throw new Error("Nenhum método de envio configurado");T.log("Submit","Response received",{hasResponse:!!d?.response,sessionId:d?.session_id,tokensUsed:d?.tokens_used,responseTimeMs:d?.response_time_ms}),w(d.session_id),S("connected");const D={id:`assistant-${Date.now()}`,role:"assistant",content:d.response,timestamp:new Date,tokens_used:d.tokens_used,response_time_ms:d.response_time_ms};h($=>[...$,D])}catch(d){T.error("Submit","Error processing message",d),S("error");let D="Erro desconhecido ao processar mensagem",$={message:"Unknown error"};d instanceof pe?(D=d.message,$={statusCode:d.statusCode,message:d.message},T.error("Submit","AgentServiceError",{statusCode:d.statusCode,message:d.message,responseData:d.responseData})):d instanceof Error&&(D=d.message,$.message=d.message,T.error("Submit","Generic Error",d.message));const de={id:`error-${Date.now()}`,role:"error",content:D,timestamp:new Date,errorDetails:$};h(oe=>[...oe,de])}finally{N(!1),m.current?.focus()}},f=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),r())},y=()=>{T.log("Clear","Clearing chat"),h([]),w(void 0),S("connected"),u?.()},R=()=>{T.log("Retry","Retrying last message");const t=[...x].reverse().find(c=>c.role==="user");t&&(z(t.content),h(c=>c.filter(d=>d.role!=="error")))};return e.jsxs("div",{className:"flex flex-col h-[600px] bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:i("w-5 h-5",g==="connected"&&"text-primary-500",g==="loading"&&"text-yellow-500 animate-pulse",g==="error"&&"text-red-500")}),e.jsxs("span",{className:"font-medium text-zinc-900 dark:text-white",children:["Testar ",a]}),g==="error"&&e.jsx("span",{className:"text-xs text-red-500 ml-2",children:"(Erro de conexão)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v&&e.jsxs("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 bg-zinc-100 dark:bg-zinc-700 px-2 py-1 rounded",children:["Session: ",v.slice(0,8),"..."]}),e.jsx("button",{onClick:()=>_(!k),className:i("p-2 rounded-lg transition-colors",k?"bg-blue-100 text-blue-600":"text-zinc-500 hover:text-blue-600 hover:bg-blue-50"),title:"Toggle debug mode",children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:y,className:"p-2 rounded-lg text-zinc-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors",title:"Limpar conversa",children:e.jsx(P,{className:"w-4 h-4"})})]})]}),k&&e.jsxs("div",{className:"px-4 py-2 bg-slate-900 text-slate-300 text-xs font-mono border-b border-zinc-700",children:[e.jsxs("div",{children:["Agent ID: ",l||"N/A"]}),e.jsxs("div",{children:["Session ID: ",v||"N/A"]}),e.jsxs("div",{children:["Status: ",g]}),e.jsxs("div",{children:["Messages: ",x.length]}),e.jsx("div",{className:"mt-1 text-slate-500",children:"Abra o console (F12) para logs detalhados"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx(E,{className:"w-16 h-16 text-zinc-200 dark:text-zinc-700 mb-4"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mb-2",children:"Inicie uma conversa com o agente"}),e.jsx("p",{className:"text-sm text-zinc-400 dark:text-zinc-500",children:"Envie uma mensagem para testar o comportamento do agente"})]}):x.map(t=>e.jsxs("div",{className:i("flex gap-3",t.role==="user"?"justify-end":"justify-start"),children:[t.role==="assistant"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center flex-shrink-0",children:e.jsx(E,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})}),t.role==="error"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center flex-shrink-0",children:e.jsx(be,{className:"w-4 h-4 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:i("max-w-[80%] rounded-2xl px-4 py-3",t.role==="user"?"bg-primary-600 text-white rounded-br-md":t.role==="error"?"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200 rounded-bl-md":"bg-zinc-100 dark:bg-zinc-800 text-zinc-900 dark:text-white rounded-bl-md"),children:[e.jsx("p",{className:"whitespace-pre-wrap break-words",children:t.content}),t.role==="assistant"&&(t.tokens_used||t.response_time_ms)&&e.jsxs("div",{className:"flex items-center gap-3 mt-2 pt-2 border-t border-zinc-200 dark:border-zinc-700",children:[t.tokens_used&&e.jsxs("span",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:[t.tokens_used," tokens"]}),t.response_time_ms&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-zinc-500 dark:text-zinc-400",children:[e.jsx(O,{className:"w-3 h-3"}),t.response_time_ms,"ms"]})]}),t.role==="error"&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-red-200 dark:border-red-800",children:[t.errorDetails?.statusCode&&e.jsxs("div",{className:"text-xs text-red-600 dark:text-red-400 mb-1",children:["Status: ",t.errorDetails.statusCode]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-1 text-xs text-red-600 dark:text-red-400 hover:underline",children:[e.jsx(q,{className:"w-3 h-3"}),"Tentar novamente"]})]})]}),t.role==="user"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center flex-shrink-0",children:e.jsx(ae,{className:"w-4 h-4 text-zinc-600 dark:text-zinc-400"})})]},t.id)),p&&e.jsxs("div",{className:"flex gap-3 justify-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center flex-shrink-0",children:e.jsx(E,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})}),e.jsx("div",{className:"bg-zinc-100 dark:bg-zinc-800 rounded-2xl rounded-bl-md px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-zinc-500 animate-spin"}),e.jsx("span",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Pensando..."})]})})]}),e.jsx("div",{ref:A})]}),e.jsxs("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-800/50",children:[e.jsxs("form",{onSubmit:r,className:"flex gap-2",children:[e.jsx("textarea",{ref:m,value:n,onChange:t=>z(t.target.value),onKeyDown:f,placeholder:"Digite sua mensagem...",disabled:p,rows:1,className:i("flex-1 px-4 py-3 rounded-xl border resize-none","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white placeholder-zinc-400","border-zinc-200 dark:border-zinc-700","focus:ring-2 focus:ring-primary-500 focus:border-transparent","disabled:opacity-50")}),e.jsx("button",{type:"submit",disabled:p||!n.trim(),className:i("px-4 py-3 rounded-xl transition-colors","bg-primary-600 hover:bg-primary-700 text-white","disabled:opacity-50 disabled:cursor-not-allowed"),children:e.jsx(ne,{className:"w-5 h-5"})})]}),e.jsxs("p",{className:"text-xs text-zinc-400 dark:text-zinc-500 mt-2 text-center",children:["Pressione Enter para enviar, Shift+Enter para nova linha",g==="error"&&e.jsx("span",{className:"text-red-500 ml-2",children:"• Erro de conexão detectado"})]})]})]})},Ee=({conversations:a,selectedId:l,onSelect:s,isLoading:u})=>{const b=x=>{const h=new Date(x),z=new Date().getTime()-h.getTime(),p=Math.floor(z/6e4),N=Math.floor(z/36e5),v=Math.floor(z/864e5);return p<1?"Agora":p<60?`${p}min atrás`:N<24?`${N}h atrás`:v<7?`${v}d atrás`:h.toLocaleDateString("pt-BR")};return u?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((x,h)=>e.jsx("div",{className:"p-4 rounded-lg border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-zinc-200 dark:bg-zinc-700"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 w-32 bg-zinc-200 dark:bg-zinc-700 rounded mb-2"}),e.jsx("div",{className:"h-3 w-24 bg-zinc-100 dark:bg-zinc-800 rounded"})]})]})},h))}):a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"w-16 h-16 mx-auto text-zinc-200 dark:text-zinc-700 mb-4"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mb-2",children:"Nenhuma conversa encontrada"}),e.jsx("p",{className:"text-sm text-zinc-400 dark:text-zinc-500",children:"As conversas aparecerão aqui quando o agente for utilizado"})]}):e.jsx("div",{className:"space-y-2",children:a.map(x=>e.jsx("button",{onClick:()=>s(x),className:i("w-full p-4 rounded-lg border text-left transition-all","hover:shadow-md",l===x.id?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 hover:border-zinc-300"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:i("w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0","bg-zinc-100 dark:bg-zinc-800"),children:e.jsx(ge,{className:"w-5 h-5 text-zinc-500 dark:text-zinc-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-zinc-900 dark:text-white truncate",children:x.phone_number||"Teste"}),e.jsx("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 flex-shrink-0",children:b(x.last_message_at)})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:[x.message_count," mensagens"]}),e.jsxs("span",{className:"text-xs text-zinc-400 dark:text-zinc-500 font-mono",children:[x.session_id.slice(0,8),"..."]})]})]}),e.jsx(je,{className:"w-5 h-5 text-zinc-400 flex-shrink-0"})]})},x.id))})},Ue=()=>{const a=I(),[l,s]=o.useState([]),[u,b]=o.useState(!0),[x,h]=o.useState(""),[n,z]=o.useState("all"),[p,N]=o.useState("all"),[v,w]=o.useState(!1),k=o.useCallback(async()=>{b(!0);try{const m=await C.getAgents();s(m)}catch(m){console.error("Erro ao carregar agentes:",m)}finally{b(!1)}},[]);o.useEffect(()=>{k()},[k]);const _=async m=>{const j=l.find(r=>r.id===m);if(j)try{const r=j.status==="active"?"inactive":"active";await C.updateAgent(m,{status:r}),s(f=>f.map(y=>y.id===m?{...y,status:r}:y))}catch(r){console.error("Erro ao atualizar status:",r)}},g=async m=>{if(confirm("Tem certeza que deseja excluir este agente?"))try{await C.deleteAgent(m),s(j=>j.filter(r=>r.id!==m))}catch(j){console.error("Erro ao excluir agente:",j)}},S=l.filter(m=>{const j=m.name.toLowerCase().includes(x.toLowerCase())||m.description?.toLowerCase().includes(x.toLowerCase()),r=n==="all"||m.status===n,f=p==="all"||m.provider===p;return j&&r&&f}),A={total:l.length,active:l.filter(m=>m.status==="active").length,inactive:l.filter(m=>m.status==="inactive").length,draft:l.filter(m=>m.status==="draft").length};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:"Agentes IA"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mt-1",children:"Gerencie seus agentes de inteligência artificial"})]}),e.jsxs("button",{onClick:()=>a("/agents/new"),className:i("inline-flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium","bg-primary-600 hover:bg-primary-700 text-white","transition-colors shadow-sm"),children:[e.jsx(Q,{className:"w-5 h-5"}),"Novo Agente"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl p-4 border border-zinc-200 dark:border-zinc-800",children:[e.jsx("div",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:A.total}),e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Total de Agentes"})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl p-4 border border-zinc-200 dark:border-zinc-800",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:A.active}),e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Ativos"})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl p-4 border border-zinc-200 dark:border-zinc-800",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-500",children:A.inactive}),e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Inativos"})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl p-4 border border-zinc-200 dark:border-zinc-800",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:A.draft}),e.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Rascunhos"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-zinc-400"}),e.jsx("input",{type:"text",value:x,onChange:m=>h(m.target.value),placeholder:"Buscar agentes...",className:i("w-full pl-10 pr-4 py-2.5 rounded-lg border","bg-white dark:bg-zinc-900","text-zinc-900 dark:text-white placeholder-zinc-400","border-zinc-200 dark:border-zinc-700","focus:ring-2 focus:ring-primary-500 focus:border-transparent")})]}),e.jsxs("button",{onClick:()=>w(!v),className:i("inline-flex items-center gap-2 px-4 py-2.5 rounded-lg border","bg-white dark:bg-zinc-900","text-zinc-700 dark:text-zinc-300","border-zinc-200 dark:border-zinc-700","hover:bg-zinc-50 dark:hover:bg-zinc-800",v&&"bg-zinc-100 dark:bg-zinc-800"),children:[e.jsx(fe,{className:"w-5 h-5"}),"Filtros"]}),e.jsx("button",{onClick:k,disabled:u,className:i("inline-flex items-center gap-2 px-4 py-2.5 rounded-lg border","bg-white dark:bg-zinc-900","text-zinc-700 dark:text-zinc-300","border-zinc-200 dark:border-zinc-700","hover:bg-zinc-50 dark:hover:bg-zinc-800","disabled:opacity-50"),children:e.jsx(q,{className:i("w-5 h-5",u&&"animate-spin")})})]}),v&&e.jsx("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Status"}),e.jsxs("select",{value:n,onChange:m=>z(m.target.value),className:i("w-full px-3 py-2 rounded-lg border","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white","border-zinc-200 dark:border-zinc-700"),children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"active",children:"Ativos"}),e.jsx("option",{value:"inactive",children:"Inativos"}),e.jsx("option",{value:"draft",children:"Rascunhos"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Provedor"}),e.jsxs("select",{value:p,onChange:m=>N(m.target.value),className:i("w-full px-3 py-2 rounded-lg border","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white","border-zinc-200 dark:border-zinc-700"),children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"kimi",children:"Kimi"}),e.jsx("option",{value:"openai",children:"OpenAI"}),e.jsx("option",{value:"anthropic",children:"Anthropic"}),e.jsx("option",{value:"ollama",children:"Ollama"})]})]})]})}),u?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((m,j)=>e.jsx("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 h-64 animate-pulse"},j))}):S.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(E,{className:"w-20 h-20 mx-auto text-zinc-200 dark:text-zinc-700 mb-4"}),l.length===0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xl font-medium text-zinc-900 dark:text-white mb-2",children:"Nenhum agente criado"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mb-6",children:"Crie seu primeiro agente IA para automatizar atendimentos"}),e.jsxs("button",{onClick:()=>a("/agents/new"),className:i("inline-flex items-center gap-2 px-6 py-3 rounded-lg font-medium","bg-primary-600 hover:bg-primary-700 text-white","transition-colors"),children:[e.jsx(Q,{className:"w-5 h-5"}),"Criar Primeiro Agente"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xl font-medium text-zinc-900 dark:text-white mb-2",children:"Nenhum resultado encontrado"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Tente ajustar os filtros ou termo de busca"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(m=>e.jsx(De,{agent:m,onEdit:j=>a(`/agents/${j}`),onDelete:g,onToggleStatus:_,onTest:j=>a(`/agents/${j}/test`),onViewConversations:j=>a(`/agents/${j}/conversations`)},m.id))})]})},Ve=()=>{const{id:a}=te(),l=I(),[s,u]=o.useState(null),[b,x]=o.useState(null),[h,n]=o.useState([]),[z,p]=o.useState(!0),[N,v]=o.useState(!1),[w,k]=o.useState("overview"),[_,g]=o.useState(null),S=o.useCallback(async()=>{if(a){p(!0);try{const[c,d,D]=await Promise.all([C.getAgent(a),C.getAgentStats(a),C.getAgentConversations(a)]);u(c),x(d),n(D)}catch(c){console.error("Erro ao carregar agente:",c)}finally{p(!1)}}},[a]);o.useEffect(()=>{S()},[S]);const A=async c=>{if(a){v(!0);try{const d=await C.updateAgent(a,c);u(d),k("overview")}catch(d){console.error("Erro ao atualizar agente:",d)}finally{v(!1)}}},m=async()=>{if(!(!s||!a))try{const c=s.status==="active"?"inactive":"active",d=await C.updateAgent(a,{status:c});u(d)}catch(c){console.error("Erro ao atualizar status:",c)}},j=async()=>{if(a&&confirm("Tem certeza que deseja excluir este agente?"))try{await C.deleteAgent(a),l("/agents")}catch(c){console.error("Erro ao excluir agente:",c)}},r=async()=>{if(s)try{const c=await C.createAgent({name:`${s.name} (cópia)`,description:s.description,provider:s.provider,model_name:s.model_name,base_url:s.base_url,temperature:s.temperature,max_tokens:s.max_tokens,timeout:s.timeout,system_prompt:s.system_prompt,context_prompt:s.context_prompt,status:"draft",use_memory:s.use_memory,memory_ttl:s.memory_ttl});l(`/agents/${c.id}`)}catch(c){console.error("Erro ao duplicar agente:",c)}},f=async(c,d)=>{if(!a)throw new Error("ID do agente não encontrado");return await C.processMessage(a,{message:c,session_id:d,context:{test:!0}})},y=[{id:"overview",label:"Visão Geral",icon:L},{id:"edit",label:"Editar",icon:re},{id:"test",label:"Testar",icon:F},{id:"conversations",label:"Conversas",icon:F}];if(z)return e.jsx("div",{className:"p-6 max-w-7xl mx-auto",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 w-64 bg-zinc-200 dark:bg-zinc-700 rounded mb-4"}),e.jsx("div",{className:"h-4 w-96 bg-zinc-100 dark:bg-zinc-800 rounded mb-8"}),e.jsx("div",{className:"grid grid-cols-4 gap-4 mb-8",children:[...Array(4)].map((c,d)=>e.jsx("div",{className:"h-24 bg-zinc-200 dark:bg-zinc-700 rounded-xl"},d))})]})});if(!s)return e.jsx("div",{className:"p-6 max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-xl font-medium text-zinc-900 dark:text-white mb-2",children:"Agente não encontrado"}),e.jsx("button",{onClick:()=>l("/agents"),className:"text-primary-600 hover:text-primary-700",children:"Voltar para lista"})]})});const R={active:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",inactive:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300",draft:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300"},t={kimi:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300",openai:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",anthropic:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",ollama:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>l("/agents"),className:"p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:e.jsx(W,{className:"w-5 h-5 text-zinc-500"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:s.name}),e.jsx("span",{className:i("px-2.5 py-0.5 rounded-full text-xs font-medium",R[s.status]),children:s.status==="active"?"Ativo":s.status==="inactive"?"Inativo":"Rascunho"}),e.jsx("span",{className:i("px-2.5 py-0.5 rounded-full text-xs font-medium",t[s.provider]),children:s.provider.toUpperCase()})]}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:s.description||`Modelo: ${s.model_name}`})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:m,className:i("inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors",s.status==="active"?"bg-yellow-100 text-yellow-700 hover:bg-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-300"),children:s.status==="active"?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4"}),"Desativar"]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4"}),"Ativar"]})}),e.jsxs("button",{onClick:r,className:i("inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors","bg-zinc-100 text-zinc-700 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-300"),children:[e.jsx(ve,{className:"w-4 h-4"}),"Duplicar"]}),e.jsxs("button",{onClick:j,className:i("inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors","bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/30 dark:text-red-300"),children:[e.jsx(P,{className:"w-4 h-4"}),"Excluir"]})]})]}),e.jsx("div",{className:"flex border-b border-zinc-200 dark:border-zinc-700 mb-6",children:y.map(c=>e.jsxs("button",{onClick:()=>k(c.id),className:i("flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors",w===c.id?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"),children:[e.jsx(c.icon,{className:"w-4 h-4"}),c.label]},c.id))}),w==="overview"&&e.jsxs("div",{className:"space-y-6",children:[b&&e.jsx(Te,{stats:b}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-6",children:[e.jsx("h3",{className:"font-semibold text-zinc-900 dark:text-white mb-4",children:"Configuração do Modelo"}),e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-zinc-500 dark:text-zinc-400",children:"Provedor"}),e.jsx("dd",{className:"font-medium text-zinc-900 dark:text-white capitalize",children:s.provider})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-zinc-500 dark:text-zinc-400",children:"Modelo"}),e.jsx("dd",{className:"font-medium text-zinc-900 dark:text-white",children:s.model_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-zinc-500 dark:text-zinc-400",children:"Temperatura"}),e.jsx("dd",{className:"font-medium text-zinc-900 dark:text-white",children:s.temperature})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-zinc-500 dark:text-zinc-400",children:"Max Tokens"}),e.jsx("dd",{className:"font-medium text-zinc-900 dark:text-white",children:s.max_tokens})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-zinc-500 dark:text-zinc-400",children:"Timeout"}),e.jsxs("dd",{className:"font-medium text-zinc-900 dark:text-white",children:[s.timeout,"s"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-zinc-500 dark:text-zinc-400",children:"Memória"}),e.jsx("dd",{className:i("font-medium",s.use_memory?"text-green-600":"text-zinc-400"),children:s.use_memory?`Ativa (TTL: ${s.memory_ttl}s)`:"Desativada"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-6",children:[e.jsx("h3",{className:"font-semibold text-zinc-900 dark:text-white mb-4",children:"System Prompt"}),e.jsx("pre",{className:"text-sm text-zinc-600 dark:text-zinc-400 whitespace-pre-wrap font-mono bg-zinc-50 dark:bg-zinc-800 p-4 rounded-lg max-h-48 overflow-y-auto",children:s.system_prompt})]})]}),s.accounts&&s.accounts.length>0&&e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-6",children:[e.jsx("h3",{className:"font-semibold text-zinc-900 dark:text-white mb-4",children:"Contas WhatsApp Associadas"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.accounts.map(c=>e.jsxs("span",{className:"px-3 py-1.5 rounded-lg bg-zinc-100 dark:bg-zinc-800 text-sm",children:[c.name," (",c.phone_number,")"]},c.id))})]})]}),w==="edit"&&e.jsx("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden",children:e.jsx(ie,{agent:{...s,accounts:s.accounts?.map(c=>c.id)||[]},onSubmit:A,onCancel:()=>k("overview"),isLoading:N})}),w==="test"&&e.jsx(ce,{agentName:s.name,onSendMessage:f,onClearChat:()=>{}}),w==="conversations"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-4",children:[e.jsxs("h3",{className:"font-semibold text-zinc-900 dark:text-white mb-4",children:["Conversas (",h.length,")"]}),e.jsx(Ee,{conversations:h,selectedId:_?.id,onSelect:g})]})}),e.jsx("div",{className:"lg:col-span-2",children:_?e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-zinc-900 dark:text-white",children:["Conversa com ",_.phone_number||"Teste"]}),e.jsx("span",{className:"text-xs text-zinc-500 font-mono",children:_.session_id})]}),_.messages?e.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto",children:_.messages.map(c=>e.jsxs("div",{className:i("p-3 rounded-lg max-w-[80%]",c.role==="user"?"ml-auto bg-primary-600 text-white":"bg-zinc-100 dark:bg-zinc-800"),children:[e.jsx("p",{className:"whitespace-pre-wrap",children:c.content}),e.jsx("p",{className:"text-xs opacity-70 mt-1",children:new Date(c.created_at).toLocaleTimeString("pt-BR")})]},c.id))}):e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Carregando mensagens..."})]}):e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-12 text-center",children:[e.jsx(F,{className:"w-16 h-16 mx-auto text-zinc-200 dark:text-zinc-700 mb-4"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Selecione uma conversa para ver os detalhes"})]})})]})]})},qe=()=>{const a=I(),[l,s]=o.useState(!1),[u,b]=o.useState([]);o.useEffect(()=>{(async()=>{try{const n=await ke.getAccounts();b(n.results||[])}catch(n){console.error("Erro ao carregar contas WhatsApp:",n)}})()},[]);const x=async h=>{s(!0);try{const n=await C.createAgent(h);a(`/agents/${n.id}`)}catch(n){console.error("Erro ao criar agente:",n)}finally{s(!1)}};return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>a("/agents"),className:"p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:e.jsx(W,{className:"w-5 h-5 text-zinc-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:"Criar Novo Agente"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Configure um novo agente de inteligência artificial"})]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden",children:e.jsx(ie,{whatsappAccounts:u,onSubmit:x,onCancel:()=>a("/agents"),isLoading:l})})]})},Be=()=>{const{id:a}=te(),l=I(),[s,u]=o.useState(null),[b,x]=o.useState(!0),h=o.useCallback(async()=>{if(a){x(!0);try{const z=await C.getAgent(a);u(z)}catch(z){console.error("Erro ao carregar agente:",z)}finally{x(!1)}}},[a]);o.useEffect(()=>{h()},[h]);const n=async(z,p)=>{if(!a)throw new Error("ID do agente não encontrado");return await C.processMessage(a,{message:z,session_id:p,context:{test:!0}})};return b?e.jsx("div",{className:"p-6 max-w-4xl mx-auto",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 w-64 bg-zinc-200 dark:bg-zinc-700 rounded mb-4"}),e.jsx("div",{className:"h-[600px] bg-zinc-200 dark:bg-zinc-700 rounded-xl"})]})}):s?e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>l(`/agents/${a}`),className:"p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:e.jsx(W,{className:"w-5 h-5 text-zinc-500"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:["Testar: ",s.name]}),e.jsxs("p",{className:"text-zinc-500 dark:text-zinc-400",children:[s.provider," / ",s.model_name]})]})]}),e.jsx(ce,{agentName:s.name,onSendMessage:n,onClearChat:()=>{}})]}):e.jsx("div",{className:"p-6 max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-xl font-medium text-zinc-900 dark:text-white mb-2",children:"Agente não encontrado"}),e.jsx("button",{onClick:()=>l("/agents"),className:"text-primary-600 hover:text-primary-700",children:"Voltar para lista"})]})})},Re=[{id:"greeting",title:"Saudação",description:"Teste a mensagem inicial com Jasper greeting",icon:L,messages:["Oi","Olá","Bom dia"]},{id:"menu",title:"Cardápio",description:"Teste a exibição do menu com categorias",icon:B,messages:["Cardápio","Ver menu","O que vocês têm?"]},{id:"product",title:"Produto",description:"Teste a exibição de um produto",icon:Ne,messages:["Quero ver produtos","Mostre o cardápio"]},{id:"cart",title:"Carrinho",description:"Teste o resumo do carrinho",icon:we,messages:["Ver carrinho","Meu carrinho","O que tenho no carrinho?"]},{id:"order",title:"Pedido",description:"Teste status do pedido",icon:ye,messages:["Status do pedido","Onde está meu pedido?"]},{id:"help",title:"Ajuda",description:"Teste mensagem de ajuda",icon:Ce,messages:["Ajuda","Não entendi","Preciso de ajuda"]}],Ke=()=>{const{accounts:a}=_e(),l=a[0],[s,u]=o.useState([]),[b,x]=o.useState(""),[h,n]=o.useState(!1),[z,p]=o.useState("5511999999999"),[N,v]=o.useState(!1),[w,k]=o.useState(""),_=o.useRef(null),g=o.useRef(null),S=o.useCallback(()=>{_.current?.scrollIntoView({behavior:"smooth"})},[]);o.useEffect(()=>{S()},[s,S]);const A=async t=>{if(t?.preventDefault(),!b.trim()||h||!l)return;const c={id:`user-${Date.now()}`,role:"user",content:b.trim(),timestamp:new Date};u(d=>[...d,c]),x(""),n(!0);try{const d=await C.processUnified(l.id,{message:c.content,phone_number:z,use_llm:!0,enable_templates:!0,enable_handlers:!0}),D={id:`assistant-${Date.now()}`,role:"assistant",content:d.content,timestamp:new Date,source:d.source,buttons:d.buttons,metadata:d.metadata};u($=>[...$,D]),d.metadata?.context&&k(JSON.stringify(d.metadata.context,null,2))}catch(d){console.error("Error:",d);const D={id:`error-${Date.now()}`,role:"system",content:"Erro ao processar mensagem. Verifique se o orquestrador está configurado.",timestamp:new Date};u($=>[...$,D])}finally{n(!1),g.current?.focus()}},m=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),A())},j=()=>{u([]),k("")},r=t=>{x(t),setTimeout(()=>A(),100)},f=t=>{switch(t){case"jasper":return e.jsx(L,{className:"w-4 h-4 text-purple-500"});case"template":return e.jsx(B,{className:"w-4 h-4 text-blue-500"});case"handler":return e.jsx(V,{className:"w-4 h-4 text-yellow-500"});case"agent":return e.jsx(E,{className:"w-4 h-4 text-green-500"});default:return e.jsx(Y,{className:"w-4 h-4 text-gray-500"})}},y=t=>{switch(t){case"jasper":return"Jasper Template";case"template":return"AutoMessage";case"handler":return"Handler";case"agent":return"LLM Direto";default:return"Fallback"}},R=t=>{switch(t){case"jasper":return"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300";case"template":return"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300";case"handler":return"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300";case"agent":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300";default:return"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-300"}};return e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1 flex flex-col h-[700px] bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-zinc-200 dark:border-zinc-700 bg-gradient-to-r from-primary-600 to-primary-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(E,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold text-white text-lg",children:"Teste do Orquestrador Unificado"}),e.jsx("p",{className:"text-primary-100 text-sm",children:"LLM + Templates + Handlers + Jasper"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>v(!N),className:i("px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",N?"bg-white text-primary-600":"bg-white/20 text-white hover:bg-white/30"),children:[e.jsx(X,{className:"w-4 h-4 inline mr-1"}),"Contexto"]}),e.jsx("button",{onClick:j,className:"p-2 rounded-lg text-white/80 hover:text-white hover:bg-white/20 transition-colors",children:e.jsx(P,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"px-4 py-2 bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Telefone:"}),e.jsx("input",{type:"text",value:z,onChange:t=>p(t.target.value),className:"flex-1 px-3 py-1 text-sm bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg",placeholder:"5511999999999"}),l&&e.jsxs("span",{className:"text-xs text-zinc-400",children:["Conta: ",l.name]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center mb-4",children:e.jsx(F,{className:"w-10 h-10 text-primary-600 dark:text-primary-400"})}),e.jsx("h3",{className:"text-xl font-medium text-zinc-900 dark:text-white mb-2",children:"Teste o Orquestrador Unificado"}),e.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 max-w-md mb-6",children:"Envie uma mensagem para ver o LLM em ação com templates Jasper, AutoMessages, Handlers e respostas diretas."}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:["Oi","Cardápio","Ver carrinho","Status do pedido"].map(t=>e.jsx("button",{onClick:()=>r(t),className:"px-4 py-2 bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded-full text-sm text-zinc-700 dark:text-zinc-300 transition-colors",children:t},t))})]}):s.map(t=>e.jsxs("div",{className:i("flex gap-3",t.role==="user"?"justify-end":"justify-start"),children:[t.role==="assistant"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center flex-shrink-0",children:e.jsx(E,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{className:i("max-w-[85%] rounded-2xl px-4 py-3",t.role==="user"?"bg-primary-600 text-white rounded-br-md":"bg-zinc-100 dark:bg-zinc-800 text-zinc-900 dark:text-white rounded-bl-md"),children:[t.role==="assistant"&&t.source&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:i("inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",R(t.source)),children:[f(t.source),y(t.source)]}),t.metadata?.jasper_template&&e.jsx("span",{className:"text-xs text-zinc-500",children:t.metadata.jasper_template}),t.metadata?.template_event&&e.jsx("span",{className:"text-xs text-zinc-500",children:t.metadata.template_event})]}),e.jsx("p",{className:"whitespace-pre-wrap break-words",children:t.content}),t.buttons&&t.buttons.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:t.buttons.map(c=>e.jsx("button",{onClick:()=>r(c.title),className:"px-3 py-1.5 bg-white dark:bg-zinc-700 border border-zinc-200 dark:border-zinc-600 rounded-lg text-sm text-zinc-700 dark:text-zinc-200 hover:bg-zinc-50 dark:hover:bg-zinc-600 transition-colors",children:c.title},c.id))}),t.metadata&&e.jsxs("div",{className:"flex items-center gap-3 mt-2 pt-2 border-t border-zinc-200 dark:border-zinc-700",children:[t.metadata.model&&e.jsx("span",{className:"text-xs text-zinc-500",children:t.metadata.model}),t.metadata.processing_time_ms&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-zinc-500",children:[e.jsx(O,{className:"w-3 h-3"}),t.metadata.processing_time_ms,"ms"]})]})]}),t.role==="user"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center flex-shrink-0",children:e.jsx(ae,{className:"w-4 h-4 text-zinc-600 dark:text-zinc-400"})})]},t.id)),h&&e.jsxs("div",{className:"flex gap-3 justify-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center flex-shrink-0",children:e.jsx(E,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})}),e.jsx("div",{className:"bg-zinc-100 dark:bg-zinc-800 rounded-2xl rounded-bl-md px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-zinc-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-zinc-400 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-zinc-400 rounded-full animate-bounce delay-200"}),e.jsx("span",{className:"text-sm text-zinc-500 dark:text-zinc-400 ml-2",children:"Orquestrador processando..."})]})})]}),e.jsx("div",{ref:_})]}),e.jsxs("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-800/50",children:[e.jsxs("form",{onSubmit:A,className:"flex gap-2",children:[e.jsx("textarea",{ref:g,value:b,onChange:t=>x(t.target.value),onKeyDown:m,placeholder:"Digite sua mensagem para testar o orquestrador...",disabled:h,rows:1,className:i("flex-1 px-4 py-3 rounded-xl border resize-none","bg-white dark:bg-zinc-800","text-zinc-900 dark:text-white placeholder-zinc-400","border-zinc-200 dark:border-zinc-700","focus:ring-2 focus:ring-primary-500 focus:border-transparent","disabled:opacity-50")}),e.jsxs("button",{type:"submit",disabled:h||!b.trim(),className:i("px-4 py-3 rounded-xl transition-colors flex items-center gap-2","bg-primary-600 hover:bg-primary-700 text-white","disabled:opacity-50 disabled:cursor-not-allowed"),children:[e.jsx(ne,{className:"w-5 h-5"}),"Enviar"]})]}),e.jsx("p",{className:"text-xs text-zinc-400 dark:text-zinc-500 mt-2 text-center",children:"Pressione Enter para enviar • Shift+Enter para nova linha"})]})]}),e.jsxs("div",{className:"w-full lg:w-80 space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-4",children:[e.jsxs("h3",{className:"font-medium text-zinc-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-primary-500"}),"Fluxos de Teste"]}),e.jsx("div",{className:"space-y-2",children:Re.map(t=>e.jsxs("div",{className:"p-3 rounded-lg bg-zinc-50 dark:bg-zinc-800/50 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(t.icon,{className:"w-4 h-4 text-zinc-500"}),e.jsx("span",{className:"font-medium text-sm text-zinc-900 dark:text-white",children:t.title})]}),e.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mb-2",children:t.description}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.messages.map(c=>e.jsx("button",{onClick:()=>r(c),className:"px-2 py-1 bg-white dark:bg-zinc-700 border border-zinc-200 dark:border-zinc-600 rounded text-xs text-zinc-600 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-600 transition-colors",children:c},c))})]},t.id))})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-4",children:[e.jsxs("h3",{className:"font-medium text-zinc-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-primary-500"}),"Como Funciona"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("span",{className:"text-zinc-600 dark:text-zinc-400",children:[e.jsx("strong",{children:"1. Detecta Intent:"})," Analisa a mensagem do cliente"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("span",{className:"text-zinc-600 dark:text-zinc-400",children:[e.jsx("strong",{children:"2. Coleta Contexto:"})," Busca templates, store, produtos"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("span",{className:"text-zinc-600 dark:text-zinc-400",children:[e.jsx("strong",{children:"3. LLM Decide:"})," Escolhe a melhor resposta"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("span",{className:"text-zinc-600 dark:text-zinc-400",children:[e.jsx("strong",{children:"4. Renderiza:"})," Aplica variáveis reais da Store"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("span",{className:"text-zinc-600 dark:text-zinc-400",children:[e.jsx("strong",{children:"5. Responde:"})," Envia com botões interativos"]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-4",children:[e.jsx("h3",{className:"font-medium text-zinc-900 dark:text-white mb-4",children:"Fontes de Resposta"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-purple-50 dark:bg-purple-900/20",children:[e.jsx(L,{className:"w-4 h-4 text-purple-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white",children:"Jasper Template"}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Templates profissionais com botões"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:[e.jsx(B,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white",children:"AutoMessage"}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Templates configuráveis do banco"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-yellow-50 dark:bg-yellow-900/20",children:[e.jsx(V,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white",children:"Handler"}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Lógica específica por intent"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-green-50 dark:bg-green-900/20",children:[e.jsx(E,{className:"w-4 h-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white",children:"LLM Direto"}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Resposta gerada pelo modelo"})]})]})]})]}),N&&w&&e.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-700 p-4",children:[e.jsxs("h3",{className:"font-medium text-slate-200 mb-2 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Contexto do LLM"]}),e.jsx("pre",{className:"text-xs text-slate-400 overflow-auto max-h-60",children:w})]})]})]})};export{qe as AgentCreatePage,Ve as AgentDetailPage,Be as AgentTestPage,Ue as AgentsPage,Ke as UnifiedOrchestratorTest};
