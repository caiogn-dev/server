import{j as e}from"./vendor-charts-o9Lo7m6Z.js";import{r as t}from"./vendor-react-C2HNIXra.js";import{U as C,R as y,Z as S,a0 as M,a4 as b,i as z,ai as L,X as g,aj as P,E as B,ak as q,aa as H,$ as Q,a7 as K,ah as O,a3 as U,W as V,al as X,a9 as Z,p as G}from"./feature-automation-CLWK1V5x.js";import{C as J}from"./ChatWindow-Bg8a9ZTJ.js";import{u as Y}from"./index-DQDVHdIA.js";import{g as ee}from"./vendor-utils-DaXQUBrP.js";import"./vendor-ui-B9rDAafI.js";import"./vendor-mui-DKuE-Kg_.js";const le=()=>{const{accounts:o,selectedAccount:s,setSelectedAccount:h}=Y(),[c,j]=t.useState("chat"),[_,x]=t.useState(!1),[R,v]=t.useState(!1),[p,$]=t.useState(null),[r,l]=t.useState({account_id:"",to:"",text:"",type:"text"}),[k,E]=t.useState([]),[f,N]=t.useState(!1),[m,F]=t.useState(""),[u,T]=t.useState("all"),[i,w]=t.useState({start:"",end:""}),d=t.useCallback(async()=>{if(s){N(!0);try{const a={};m&&(a.search=m),u!=="all"&&(a.direction=u),i.start&&(a.created_after=i.start),i.end&&(a.created_before=i.end);const n=await C.getMessages(s.id,a);E(n.results||[])}catch(a){y.error(S(a))}finally{N(!1)}}},[s,m,u,i]);t.useEffect(()=>{c==="table"&&d()},[c,d]);const A=async a=>{a.preventDefault(),v(!0);try{await C.sendTextMessage({account_id:r.account_id,to:r.to,text:r.text}),y.success("Mensagem enviada com sucesso!"),x(!1),l({account_id:"",to:"",text:"",type:"text"}),c==="table"&&d()}catch(n){y.error(S(n))}finally{v(!1)}},D=a=>{$(a)};t.useEffect(()=>{!s&&o.length>0&&h(o[0])},[o,s,h]);const I=[{key:"direction",header:"Direção",render:a=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${a.direction==="inbound"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}`,children:a.direction==="inbound"?"← Recebida":"→ Enviada"})},{key:"contact",header:"Contato",render:a=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.direction==="inbound"?a.from_number:a.to_number}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:a.account_name})]})},{key:"content",header:"Conteúdo",render:a=>e.jsx("div",{className:"max-w-md",children:e.jsx("p",{className:"text-sm text-gray-900 dark:text-white truncate",children:a.text_body||`[${a.message_type}]`})})},{key:"type",header:"Tipo",render:a=>e.jsx("span",{className:"text-sm text-gray-600 dark:text-zinc-400 capitalize",children:a.message_type})},{key:"status",header:"Status",render:a=>e.jsx(Z,{status:a.status})},{key:"created_at",header:"Data",render:a=>e.jsx("span",{className:"text-sm text-gray-600 dark:text-zinc-400",children:ee(new Date(a.created_at),"dd/MM/yyyy HH:mm",{locale:G})})}];return s?e.jsxs("div",{className:"h-full flex flex-col p-6",children:[e.jsx(M,{title:"Mensagens",subtitle:p?`Conversa com ${p.contact_name||p.phone_number}`:`${s.name}`,actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>j("chat"),className:`flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${c==="chat"?"bg-white dark:bg-gray-600 text-primary-600 dark:text-primary-400 shadow-sm":"text-gray-600 dark:text-zinc-400 hover:text-gray-900 dark:hover:text-white"}`,children:[e.jsx(z,{className:"w-4 h-4"}),"Chat"]}),e.jsxs("button",{onClick:()=>j("table"),className:`flex items-center gap-1 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${c==="table"?"bg-white dark:bg-gray-600 text-primary-600 dark:text-primary-400 shadow-sm":"text-gray-600 dark:text-zinc-400 hover:text-gray-900 dark:hover:text-white"}`,children:[e.jsx(L,{className:"w-4 h-4"}),"Tabela"]})]}),e.jsx(g,{leftIcon:e.jsx(P,{className:"w-5 h-5"}),onClick:()=>{l({...r,account_id:s.id}),x(!0)},children:"Nova Mensagem"})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 dark:text-zinc-300",children:"Conta WhatsApp:"}),e.jsxs("select",{value:s?.id||"",onChange:a=>{const n=o.find(W=>W.id===a.target.value);h(n||null)},className:"px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg text-sm bg-white dark:bg-zinc-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-[#722F37] focus:border-[#722F37]",children:[e.jsx("option",{value:"",children:"Todas as contas"}),o.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),c==="chat"?e.jsx("div",{className:"h-full",style:{minHeight:"calc(100vh - 200px)"},children:e.jsx(J,{accountId:s.id,accountName:s.name,onConversationSelect:D})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar mensagens...",value:m,onChange:a=>F(a.target.value),onKeyPress:a=>a.key==="Enter"&&d(),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg text-sm bg-white dark:bg-zinc-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:u,onChange:a=>T(a.target.value),className:"px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg text-sm bg-white dark:bg-zinc-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"inbound",children:"Recebidas"}),e.jsx("option",{value:"outbound",children:"Enviadas"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:i.start,onChange:a=>w(n=>({...n,start:a.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg text-sm bg-white dark:bg-zinc-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-500",children:"até"}),e.jsx("input",{type:"date",value:i.end,onChange:a=>w(n=>({...n,end:a.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg text-sm bg-white dark:bg-zinc-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsx(g,{variant:"secondary",leftIcon:e.jsx(H,{className:`w-4 h-4 ${f?"animate-spin":""}`}),onClick:d,isLoading:f,children:"Atualizar"})]})}),e.jsx(b,{noPadding:!0,children:f?e.jsx(Q,{}):e.jsx(K,{columns:I,data:k,keyExtractor:a=>a.id,emptyMessage:"Nenhuma mensagem encontrada"})}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-zinc-400 text-center",children:[k.length," mensagem(ns) encontrada(s)"]})]})]}),e.jsx(O,{isOpen:_,onClose:()=>x(!1),title:"Enviar Nova Mensagem",size:"md",children:e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsx(U,{label:"Conta WhatsApp",required:!0,value:r.account_id,onChange:a=>l({...r,account_id:a.target.value}),options:[{value:"",label:"Selecione uma conta"},...o.map(a=>({value:a.id,label:a.name}))]}),e.jsx(V,{label:"Número de Destino",required:!0,value:r.to,onChange:a=>l({...r,to:a.target.value}),placeholder:"5511999999999",helperText:"Digite o número com código do país (ex: 5511999999999)"}),e.jsx(X,{label:"Mensagem",required:!0,rows:4,value:r.text,onChange:a=>l({...r,text:a.target.value}),placeholder:"Digite sua mensagem..."}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(g,{variant:"secondary",onClick:()=>x(!1),children:"Cancelar"}),e.jsx(g,{type:"submit",isLoading:R,children:"Enviar"})]})]})})]}):e.jsxs("div",{className:"p-6",children:[e.jsx(M,{title:"Mensagens",subtitle:"Selecione uma conta WhatsApp"}),e.jsxs(b,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(z,{className:"w-16 h-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Nenhuma conta selecionada"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400 text-center max-w-md",children:"Selecione uma conta WhatsApp no menu superior para visualizar e gerenciar suas conversas."})]})]})};export{le as MessagesPage};
