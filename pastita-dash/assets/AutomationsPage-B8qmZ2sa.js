import{j as e}from"./vendor-charts-o9Lo7m6Z.js";import{e as G,r as l}from"./vendor-react-C2HNIXra.js";import{d as L,a5 as O,X as d,a6 as w,a4 as n,v as _,aM as C,t as q,af as U,z as B,bf as z,aL as H,aO as Q,ah as E,l as u,R as t}from"./feature-automation-CLWK1V5x.js";import"./index-DQDVHdIA.js";import{a as x}from"./marketingService-D9ImcE5m.js";import"./vendor-utils-DaXQUBrP.js";import"./vendor-ui-B9rDAafI.js";import"./vendor-mui-DKuE-Kg_.js";const V={new_user:{icon:"üë§",color:"text-blue-600",bgColor:"bg-blue-100"},welcome:{icon:"üëã",color:"text-green-600",bgColor:"bg-green-100"},order_confirmed:{icon:"‚úÖ",color:"text-emerald-600",bgColor:"bg-emerald-100"},order_preparing:{icon:"üë®‚Äçüç≥",color:"text-orange-600",bgColor:"bg-orange-100"},order_shipped:{icon:"üöö",color:"text-blue-600",bgColor:"bg-blue-100"},order_delivered:{icon:"üì¶",color:"text-green-600",bgColor:"bg-green-100"},order_cancelled:{icon:"‚ùå",color:"text-red-600",bgColor:"bg-red-100"},payment_confirmed:{icon:"üí≥",color:"text-green-600",bgColor:"bg-green-100"},payment_failed:{icon:"‚ö†Ô∏è",color:"text-red-600",bgColor:"bg-red-100"},cart_abandoned:{icon:"üõí",color:"text-yellow-600",bgColor:"bg-yellow-100"},coupon_sent:{icon:"üéüÔ∏è",color:"text-purple-600",bgColor:"bg-purple-100"},birthday:{icon:"üéÇ",color:"text-pink-600",bgColor:"bg-pink-100"},review_request:{icon:"‚≠ê",color:"text-yellow-600",bgColor:"bg-yellow-100"}};function re(){G();const{storeId:o}=L(),[c,p]=l.useState([]),[A,F]=l.useState([]),[T,j]=l.useState(!0),[S,m]=l.useState(!1),[R,h]=l.useState(!1),[y,N]=l.useState(null),[f,b]=l.useState(""),[s,i]=l.useState({name:"",trigger_type:"",subject:"",html_content:"",delay_minutes:0,is_active:!0});l.useEffect(()=>{(async()=>{if(!o){j(!1);return}try{j(!0);const[r,g]=await Promise.all([x.list(o),x.getTriggerTypes()]);p(r),F(g)}catch(r){u.error("Failed to load automations",r),t.error("Erro ao carregar automa√ß√µes")}finally{j(!1)}})()},[o]);const $=async a=>{try{const r=await x.toggle(a.id);p(g=>g.map(k=>k.id===a.id?r:k)),t.success(r.is_active?"Automa√ß√£o ativada":"Automa√ß√£o pausada")}catch(r){u.error("Failed to toggle automation",r),t.error("Erro ao alterar automa√ß√£o")}},D=async a=>{if(confirm(`Excluir automa√ß√£o "${a.name}"?`))try{await x.delete(a.id),p(r=>r.filter(g=>g.id!==a.id)),t.success("Automa√ß√£o exclu√≠da")}catch(r){u.error("Failed to delete automation",r),t.error("Erro ao excluir automa√ß√£o")}},M=async()=>{if(!o||!s.name||!s.trigger_type||!s.subject){t.error("Preencha todos os campos obrigat√≥rios");return}try{const a=await x.create({store:o,...s});p(r=>[...r,a]),m(!1),v(),t.success("Automa√ß√£o criada com sucesso!")}catch(a){u.error("Failed to create automation",a),t.error("Erro ao criar automa√ß√£o")}},P=async()=>{if(!y||!f){t.error("Informe um email para teste");return}try{const a=await x.test(y.id,f);a.success?(t.success("Email de teste enviado!"),h(!1),b("")):t.error(a.error||"Erro ao enviar teste")}catch(a){u.error("Failed to send test",a),t.error("Erro ao enviar email de teste")}},v=()=>{i({name:"",trigger_type:"",subject:"",html_content:"",delay_minutes:0,is_active:!0})},I=a=>{N(a),h(!0)};return T?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(O,{size:"lg"})}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Automa√ß√µes de Email"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400 mt-1",children:"Configure emails autom√°ticos para eventos do sistema"})]}),e.jsxs(d,{onClick:()=>m(!0),children:[e.jsx(w,{className:"w-5 h-5 mr-2"}),"Nova Automa√ß√£o"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(_,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:c.length}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Total"})]})]})}),e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/40 rounded-lg",children:e.jsx(C,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:c.filter(a=>a.is_active).length}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Ativas"})]})]})}),e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/40 rounded-lg",children:e.jsx(q,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:c.reduce((a,r)=>a+r.total_sent,0)}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Emails Enviados"})]})]})}),e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/40 rounded-lg",children:e.jsx(U,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:c.reduce((a,r)=>a+r.total_opened,0)}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Abertos"})]})]})})]}),c.length===0?e.jsxs(n,{className:"p-12 text-center",children:[e.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Nenhuma automa√ß√£o configurada"}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400 mb-4",children:"Crie automa√ß√µes para enviar emails automaticamente quando eventos ocorrerem"}),e.jsxs(d,{onClick:()=>m(!0),children:[e.jsx(w,{className:"w-5 h-5 mr-2"}),"Criar Primeira Automa√ß√£o"]})]}):e.jsx("div",{className:"grid gap-4",children:c.map(a=>{const r=V[a.trigger_type]||{icon:"üìß",bgColor:"bg-gray-100"};return e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${r.bgColor}`,children:e.jsx("span",{className:"text-2xl",children:r.icon})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),a.is_active?e.jsx("span",{className:"px-2 py-0.5 text-xs bg-green-100 dark:bg-green-900/40 text-green-700 dark:text-green-300 rounded-full",children:"Ativa"}):e.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-zinc-400 rounded-full",children:"Pausada"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:[a.trigger_type_display,a.delay_minutes>0&&e.jsxs("span",{className:"ml-2",children:[e.jsx(B,{className:"w-4 h-4 inline mr-1"}),a.delay_minutes," min de delay"]})]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Assunto: ",a.subject]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right text-sm",children:[e.jsx("p",{className:"text-gray-900 dark:text-white font-medium",children:a.total_sent}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:"enviados"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>I(a),className:"p-2 text-gray-400 hover:text-blue-600 dark:text-blue-400 hover:bg-blue-50 rounded-lg",title:"Enviar teste",children:e.jsx(z,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>$(a),className:`p-2 rounded-lg ${a.is_active?"text-yellow-600 hover:bg-yellow-50":"text-green-600 hover:bg-green-50"}`,title:a.is_active?"Pausar":"Ativar",children:a.is_active?e.jsx(H,{className:"w-5 h-5"}):e.jsx(C,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>D(a),className:"p-2 text-gray-400 hover:text-red-600 dark:text-red-400 hover:bg-red-50 rounded-lg",title:"Excluir",children:e.jsx(Q,{className:"w-5 h-5"})})]})]})]})},a.id)})}),e.jsx(E,{isOpen:S,onClose:()=>{m(!1),v()},title:"Nova Automa√ß√£o de Email",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Nome da Automa√ß√£o *"}),e.jsx("input",{type:"text",value:s.name,onChange:a=>i(r=>({...r,name:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Ex: Email de confirma√ß√£o de pedido"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Gatilho (Quando enviar) *"}),e.jsxs("select",{value:s.trigger_type,onChange:a=>i(r=>({...r,trigger_type:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Selecione um gatilho..."}),A.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Assunto do Email *"}),e.jsx("input",{type:"text",value:s.subject,onChange:a=>i(r=>({...r,subject:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Ex: Seu pedido #{{order_number}} foi confirmado!"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"üìù Vari√°veis Dispon√≠veis"}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mb-2",children:"Use estas vari√°veis no assunto e conte√∫do - ser√£o preenchidas automaticamente:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-900/40 text-blue-800 px-1.5 py-0.5 rounded",children:"{{customer_name}}"}),e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-900/40 text-blue-800 px-1.5 py-0.5 rounded",children:"{{first_name}}"}),e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-900/40 text-blue-800 px-1.5 py-0.5 rounded",children:"{{email}}"}),e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-900/40 text-blue-800 px-1.5 py-0.5 rounded",children:"{{store_name}}"}),e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-900/40 text-blue-800 px-1.5 py-0.5 rounded",children:"{{order_number}}"}),e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-900/40 text-blue-800 px-1.5 py-0.5 rounded",children:"{{order_total}}"}),e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-900/40 text-blue-800 px-1.5 py-0.5 rounded",children:"{{tracking_code}}"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Conte√∫do HTML *"}),e.jsx("textarea",{value:s.html_content,onChange:a=>i(r=>({...r,html_content:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500 font-mono text-sm",rows:8,placeholder:"<html>...</html>"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400 mt-1",children:"üí° Dica: Copie um template da p√°gina de Marketing e personalize aqui"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Delay (minutos)"}),e.jsx("input",{type:"number",min:"0",value:s.delay_minutes,onChange:a=>i(r=>({...r,delay_minutes:parseInt(a.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400 mt-1",children:'0 = envio imediato. Use delay para emails como "solicitar avalia√ß√£o" (ex: 1440 = 24h)'})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:s.is_active,onChange:a=>i(r=>({...r,is_active:a.target.checked})),className:"rounded border-gray-300 dark:border-zinc-700 text-primary-600 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm text-gray-700 dark:text-zinc-300",children:"Ativar automa√ß√£o imediatamente"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(d,{variant:"secondary",onClick:()=>{m(!1),v()},children:"Cancelar"}),e.jsx(d,{onClick:M,children:"Criar Automa√ß√£o"})]})]})}),e.jsx(E,{isOpen:R,onClose:()=>{h(!1),b(""),N(null)},title:"Enviar Email de Teste",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-zinc-400",children:["Envie um email de teste para verificar como a automa√ß√£o",e.jsxs("strong",{children:[' "',y?.name,'"']})," ser√° exibida."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-zinc-300 mb-1",children:"Email para teste"}),e.jsx("input",{type:"email",value:f,onChange:a=>b(a.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"seu@email.com"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(d,{variant:"secondary",onClick:()=>{h(!1),b("")},children:"Cancelar"}),e.jsxs(d,{onClick:P,children:[e.jsx(z,{className:"w-5 h-5 mr-2"}),"Enviar Teste"]})]})]})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:"Selecione uma loja para gerenciar automa√ß√µes"})})}export{re as default};
