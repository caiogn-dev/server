import{j as e}from"./vendor-charts-o9Lo7m6Z.js";import{r as d,u as U}from"./vendor-react-C2HNIXra.js";import{d as V,an as F,l as D,R as h,$ as q,a0 as Q,a4 as g,a2 as z,af as P,z as A,aG as T,aH as W,X as M,aa as b,a7 as Z,aI as ee,aJ as te,p as E,C as v,aK as ae,ag as re}from"./feature-automation-CLWK1V5x.js";import"./index-DQDVHdIA.js";import{g as L}from"./vendor-utils-DaXQUBrP.js";import"./vendor-ui-B9rDAafI.js";import"./vendor-mui-DKuE-Kg_.js";const O=[{value:"pending",label:"Aguardando",color:"warning"},{value:"processing",label:"Processando",color:"purple"},{value:"paid",label:"Pago",color:"success"},{value:"failed",label:"Falhou",color:"danger"},{value:"refunded",label:"Reembolsado",color:"gray"},{value:"partially_refunded",label:"Reembolso Parcial",color:"orange"}],se={pix:{label:"PIX",icon:e.jsx(ae,{className:"w-4 h-4"})},credit_card:{label:"CrÃ©dito",icon:e.jsx(v,{className:"w-4 h-4"})},debit_card:{label:"DÃ©bito",icon:e.jsx(v,{className:"w-4 h-4"})},cash:{label:"Dinheiro",icon:e.jsx(T,{className:"w-4 h-4"})},card:{label:"CartÃ£o",icon:e.jsx(v,{className:"w-4 h-4"})},mercadopago:{label:"Mercado Pago",icon:e.jsx(z,{className:"w-4 h-4"})}},ne=({status:s})=>{const x={pending:{bg:"bg-amber-100 dark:bg-amber-900/40 dark:bg-amber-900/40",text:"text-amber-800 dark:text-amber-300",icon:e.jsx(A,{className:"w-4 h-4"})},processing:{bg:"bg-purple-100 dark:bg-purple-900/40 dark:bg-purple-900/40",text:"text-purple-800 dark:text-purple-300",icon:e.jsx(b,{className:"w-4 h-4 animate-spin"})},paid:{bg:"bg-green-100 dark:bg-green-900/40 dark:bg-green-900/40",text:"text-green-800 dark:text-green-300",icon:e.jsx(P,{className:"w-4 h-4"})},failed:{bg:"bg-red-100 dark:bg-red-900/40 dark:bg-red-900/40",text:"text-red-800 dark:text-red-300",icon:e.jsx(re,{className:"w-4 h-4"})},refunded:{bg:"bg-gray-100 dark:bg-gray-700 dark:bg-gray-700",text:"text-gray-800 dark:text-gray-200 dark:text-zinc-300",icon:e.jsx(b,{className:"w-4 h-4"})},partially_refunded:{bg:"bg-orange-100 dark:bg-orange-900/40 dark:bg-orange-900/40",text:"text-orange-800 dark:text-orange-300",icon:e.jsx(b,{className:"w-4 h-4"})}},{bg:k,text:p,icon:c}=x[s]||x.pending,y=O.find(l=>l.value===s)?.label||s;return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold ${k} ${p}`,children:[c,y]})},ge=()=>{const[s,x]=d.useState([]),[k,p]=d.useState(!0),[c,y]=d.useState(null),{storeId:l}=U(),{storeSlug:R,stores:S}=V(),f=d.useMemo(()=>{if(!l)return R||null;const t=S.find(a=>a.id===l||a.slug===l);return t?.slug||t?.id||l},[l,R,S]),j=d.useCallback(async()=>{p(!0);try{const t={ordering:"-created_at"};f&&(t.store=f);const a=await F.getOrders(t);x(a.results)}catch(t){D.error("Error loading payments:",t),h.error("Erro ao carregar pagamentos")}finally{p(!1)}},[f]);d.useEffect(()=>{j()},[j]);const I=async t=>{try{const a=await F.markPaid(t.id);x(s.map(n=>n.id===t.id?{...n,payment_status:a.payment_status,status:a.status}:n)),h.success(`Pagamento do pedido #${t.order_number} confirmado!`)}catch(a){D.error("Error confirming payment:",a),h.error("Erro ao confirmar pagamento")}},o=d.useMemo(()=>{const t=s.filter(r=>r.payment_status==="paid").reduce((r,i)=>r+Number(i.total||0),0),a=s.filter(r=>r.payment_status==="pending").reduce((r,i)=>r+Number(i.total||0),0),n=s.filter(r=>{const i=new Date(r.created_at),N=new Date;return i.toDateString()===N.toDateString()}),u=n.filter(r=>r.payment_status==="paid").reduce((r,i)=>r+Number(i.total||0),0);return{totalRevenue:t,pendingAmount:a,todayRevenue:u,todayCount:n.length,paidCount:s.filter(r=>r.payment_status==="paid").length,pendingCount:s.filter(r=>r.payment_status==="pending").length}},[s]),C=d.useMemo(()=>s.reduce((t,a)=>{const n=a.payment_status||"pending";return t[n]=(t[n]||0)+1,t},{}),[s]),B=d.useMemo(()=>c?s.filter(t=>t.payment_status===c):s,[s,c]),H=d.useMemo(()=>O.map(t=>({...t,count:C[t.value]||0})),[C]),m=t=>`R$ ${(typeof t=="string"?parseFloat(t):t).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`,X=[{key:"order_number",header:"Pedido",render:t=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:["#",t.order_number]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400",children:t.customer_name})]})},{key:"total",header:"Valor",render:t=>e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:m(t.total)})},{key:"payment_method",header:"MÃ©todo",render:t=>{const a=t.payment_method||"pix",n=se[a]||{label:a,icon:e.jsx(z,{className:"w-4 h-4"})};return e.jsxs("span",{className:"inline-flex items-center gap-1.5 text-sm text-gray-700 dark:text-zinc-300",children:[n.icon,n.label]})}},{key:"payment_status",header:"Status",render:t=>e.jsx(ne,{status:t.payment_status||"pending"})},{key:"payment_link",header:"Link Pagamento",render:t=>{const{payment_method:a,pix_code:n,access_token:u,pix_ticket_url:r,payment_url:i,payment_link:N,init_point:Y,payment_preference_id:$}=t,G=i||N||Y,J=$?`https://www.mercadopago.com.br/checkout/v1/redirect?pref_id=${$}`:null,K=n&&u?`https://pastita.com.br/pendente?token=${u}`:null,w=r||K||G||J;return w?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("a",{href:w,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1.5 px-2.5 py-1.5 text-sm text-blue-700 dark:text-blue-300 bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/40 rounded-lg font-medium transition-colors",onClick:_=>_.stopPropagation(),children:[e.jsx(ee,{className:"w-4 h-4"}),"Abrir"]}),e.jsx("button",{onClick:_=>{_.stopPropagation(),navigator.clipboard.writeText(w),h.success("Link copiado! Envie para o cliente.")},className:"p-1.5 text-gray-500 dark:text-zinc-400 hover:text-gray-700 dark:hover:text-zinc-300 dark:hover:text-zinc-300 hover:bg-gray-100 dark:hover:bg-zinc-700 dark:bg-gray-700 rounded",title:"Copiar link",children:e.jsx(te,{className:"w-4 h-4"})})]}):a==="cash"?e.jsx("span",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"ðŸ’µ Dinheiro"}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}},{key:"created_at",header:"Data",render:t=>e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-gray-900 dark:text-white",children:L(new Date(t.created_at),"dd/MM/yyyy",{locale:E})}),e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:L(new Date(t.created_at),"HH:mm",{locale:E})})]})},{key:"actions",header:"AÃ§Ãµes",render:t=>e.jsxs("div",{className:"flex items-center gap-2",children:[t.payment_status==="pending"&&e.jsxs(M,{size:"sm",onClick:a=>{a.stopPropagation(),I(t)},children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"Confirmar"]}),t.payment_status==="paid"&&e.jsx("span",{className:"text-sm text-green-600 dark:text-green-400 font-medium",children:"âœ“ Pago"})]})}];return k?e.jsx(q,{}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(Q,{title:"Pagamentos",subtitle:`${s.length} pedido(s) | ${m(o.totalRevenue)} recebido`}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/40 dark:bg-green-900/40 rounded-lg",children:e.jsx(z,{className:"w-6 h-6 text-green-600 dark:text-green-400 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 dark:text-zinc-400",children:"Receita Hoje"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white dark:text-white",children:m(o.todayRevenue)}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-zinc-400 dark:text-zinc-400",children:[o.todayCount," pedido(s)"]})]})]})}),e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/40 dark:bg-blue-900/40 rounded-lg",children:e.jsx(P,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 dark:text-zinc-400",children:"Total Recebido"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white dark:text-white",children:m(o.totalRevenue)}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-zinc-400 dark:text-zinc-400",children:[o.paidCount," pago(s)"]})]})]})}),e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/40 dark:bg-amber-900/40 rounded-lg",children:e.jsx(A,{className:"w-6 h-6 text-amber-600 dark:text-amber-400 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 dark:text-zinc-400",children:"Aguardando"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white dark:text-white",children:m(o.pendingAmount)}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-zinc-400 dark:text-zinc-400",children:[o.pendingCount," pendente(s)"]})]})]})}),e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/40 dark:bg-purple-900/40 rounded-lg",children:e.jsx(T,{className:"w-6 h-6 text-purple-600 dark:text-purple-400 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 dark:text-zinc-400",children:"Total Pedidos"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white dark:text-white",children:s.length}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400 dark:text-zinc-400",children:"todos os tempos"})]})]})})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsx(W,{options:H,value:c,onChange:y,className:"flex-wrap"}),e.jsxs(M,{variant:"secondary",size:"sm",onClick:j,children:[e.jsx(b,{className:"w-4 h-4 mr-1"}),"Atualizar"]})]}),e.jsx(g,{noPadding:!0,children:e.jsx(Z,{columns:X,data:B,keyExtractor:t=>t.id,emptyMessage:"Nenhum pagamento encontrado"})})]})};export{ge as PaymentsPage,ge as default};
