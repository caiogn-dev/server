import{j as e}from"./vendor-charts-o9Lo7m6Z.js";import{u as B,e as F,r as n}from"./vendor-react-C2HNIXra.js";import{U as r,R as c,Z as u,$ as H,a0 as O,X as l,ac as W,a4 as m,a9 as S,aa as q,ad as J,a1 as p,ae as U,af as A,ag as V,ah as X,W as Z,p as T}from"./feature-automation-CLWK1V5x.js";import{g as _}from"./vendor-utils-DaXQUBrP.js";import"./vendor-ui-B9rDAafI.js";import"./vendor-mui-DKuE-Kg_.js";const ae=()=>{const{id:i}=B(),g=F(),[s,w]=n.useState(null),[j,D]=n.useState([]),[t,C]=n.useState(null),[o,M]=n.useState(null),[R,z]=n.useState(!0),[y,d]=n.useState(null),[I,h]=n.useState(!1),[f,b]=n.useState("");n.useEffect(()=>{i&&v()},[i]);const v=async()=>{if(i){z(!0);try{const a=await r.getAccount(i);w(a);const x=await r.getTemplates(i);D(x.results);try{const k=await r.getBusinessProfile(i);C(k)}catch{}const $=new Date,N=new Date;N.setDate(N.getDate()-30);try{const k=await r.getMessageStats(i,N.toISOString().split("T")[0],$.toISOString().split("T")[0]);M(k)}catch{}}catch(a){c.error(u(a)),g("/accounts")}finally{z(!1)}}},P=async()=>{if(s){d("status");try{const a=s.status==="active"?await r.deactivateAccount(s.id):await r.activateAccount(s.id);w(a),c.success(`Conta ${a.status==="active"?"ativada":"desativada"} com sucesso!`)}catch(a){c.error(u(a))}finally{d(null)}}},E=async()=>{if(s){d("sync");try{const a=await r.syncTemplates(s.id);c.success(a.message),v()}catch(a){c.error(u(a))}finally{d(null)}}},L=async a=>{if(a.preventDefault(),!(!s||!f)){d("rotate");try{const x=await r.rotateToken(s.id,f);c.success(x.message),h(!1),b(""),v()}catch(x){c.error(u(x))}finally{d(null)}}};return R||!s?e.jsx(H,{}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(O,{title:s.name,subtitle:s.display_phone_number||s.phone_number,actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"secondary",leftIcon:e.jsx(W,{className:"w-5 h-5"}),onClick:()=>g("/accounts"),children:"Voltar"}),e.jsx(l,{variant:"secondary",onClick:()=>g(`/accounts/${s.id}/edit`),children:"Editar"})]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(S,{status:s.status}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-zinc-400",children:["Token v",s.token_version]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(l,{variant:s.status==="active"?"secondary":"primary",size:"sm",isLoading:y==="status",onClick:P,children:s.status==="active"?"Desativar":"Ativar"}),e.jsx(l,{variant:"secondary",size:"sm",leftIcon:e.jsx(q,{className:"w-4 h-4"}),isLoading:y==="sync",onClick:E,children:"Sincronizar Templates"}),e.jsx(l,{variant:"secondary",size:"sm",leftIcon:e.jsx(J,{className:"w-4 h-4"}),onClick:()=>h(!0),children:"Rotacionar Token"})]})]})}),o&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(p,{title:"Mensagens Enviadas",value:o.sent||0,icon:e.jsx(U,{className:"w-6 h-6"})}),e.jsx(p,{title:"Mensagens Entregues",value:o.delivered||0,icon:e.jsx(A,{className:"w-6 h-6"})}),e.jsx(p,{title:"Mensagens Lidas",value:o.read||0,icon:e.jsx(A,{className:"w-6 h-6"})}),e.jsx(p,{title:"Mensagens Falhas",value:o.failed||0,icon:e.jsx(V,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(m,{title:"Detalhes da Conta",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Phone Number ID"}),e.jsx("p",{className:"font-mono text-sm",children:s.phone_number_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"WABA ID"}),e.jsx("p",{className:"font-mono text-sm",children:s.waba_id})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Resposta Automática"}),e.jsx("p",{className:s.auto_response_enabled?"text-green-600":"text-gray-400",children:s.auto_response_enabled?"Ativada":"Desativada"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Handoff Humano"}),e.jsx("p",{className:s.human_handoff_enabled?"text-green-600":"text-gray-400",children:s.human_handoff_enabled?"Ativado":"Desativado"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Criado em"}),e.jsx("p",{children:_(new Date(s.created_at),"dd/MM/yyyy HH:mm",{locale:T})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Atualizado em"}),e.jsx("p",{children:_(new Date(s.updated_at),"dd/MM/yyyy HH:mm",{locale:T})})]})]}),s.default_agent&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Agente IA Padrão"}),e.jsx("p",{className:"font-medium",children:s.default_agent_name||s.default_agent})]})]})}),e.jsx(m,{title:"Perfil do Negócio",children:t?e.jsxs("div",{className:"space-y-4",children:[t.about&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Sobre"}),e.jsx("p",{children:t.about})]}),t.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Endereço"}),e.jsx("p",{children:t.address})]}),t.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Email"}),e.jsx("p",{children:t.email})]}),t.websites&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400",children:"Websites"}),e.jsx("p",{children:t.websites})]})]}):e.jsx("p",{className:"text-gray-500 dark:text-zinc-400",children:"Perfil não disponível"})})]}),e.jsx(m,{title:`Templates de Mensagem (${j.length})`,children:j.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-zinc-400 uppercase",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-zinc-400 uppercase",children:"Idioma"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-zinc-400 uppercase",children:"Categoria"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-zinc-400 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white",children:a.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500 dark:text-zinc-400",children:a.language}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500 dark:text-zinc-400",children:a.category}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(S,{status:a.status})})]},a.id))})]})}):e.jsx("p",{className:"text-gray-500 dark:text-zinc-400 text-center py-8",children:'Nenhum template encontrado. Clique em "Sincronizar Templates" para importar.'})}),s.metadata&&Object.keys(s.metadata).length>0&&e.jsx(m,{title:"Metadados",children:e.jsx("pre",{className:"bg-gray-50 dark:bg-black p-4 rounded-lg overflow-x-auto text-sm",children:JSON.stringify(s.metadata,null,2)})}),e.jsx(X,{isOpen:I,onClose:()=>h(!1),title:"Rotacionar Token de Acesso",size:"sm",children:e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-zinc-400",children:"Insira o novo token de acesso do WhatsApp Business API. O token atual será substituído."}),e.jsx(Z,{label:"Novo Token de Acesso",type:"password",required:!0,value:f,onChange:a=>b(a.target.value),placeholder:"EAAxxxxxxx..."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(l,{variant:"secondary",onClick:()=>h(!1),children:"Cancelar"}),e.jsx(l,{type:"submit",isLoading:y==="rotate",children:"Rotacionar Token"})]})]})})]})};export{ae as AccountDetailPage};
